<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Project Archives - SK Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/responsive.css" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config/env.js"></script>
    <script src="js/config/supabase.js"></script>
    <script src="js/auth/session.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#2f6e4e",
              secondary: "#3d8b64",
            },
            fontFamily: {
              sans: ["Inter", "system-ui", "sans-serif"],
            },
          },
        },
      };
    </script>
    <style>
      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-10px);
        }
        75% {
          transform: translateX(10px);
        }
      }
      .icon-wrapper {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .icon-wrapper:hover {
        transform: translateY(-2px);
      }
      .nav-link svg {
        transition: all 0.3s ease;
      }
      .nav-link:hover svg {
        transform: scale(1.1);
      }
      .icon-badge {
        box-shadow: 0 2px 8px rgba(47, 110, 78, 0.15);
      }
      .notification-icon {
        position: relative;
      }
      .notification-icon:hover {
        transform: rotate(15deg) scale(1.1);
        transition: transform 0.3s ease;
      }
      .status-icon-pending {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      }
      .status-icon-approved {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      }
      .status-icon-rejected {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      }
      .icon-primary {
        filter: drop-shadow(0 2px 4px rgba(47, 110, 78, 0.1));
      }
      .icon-glow {
        filter: drop-shadow(0 0 8px rgba(47, 110, 78, 0.3));
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <div class="flex h-screen overflow-hidden">
      <!-- Sidebar Navigation -->
      <aside
        class="w-64 bg-white shadow-lg flex-shrink-0 h-screen flex flex-col"
      >
        <div class="p-6 flex-1 flex flex-col">
          <!-- Logo -->
          <div class="flex items-center space-x-4 mb-8">
            <div
              class="w-12 h-12 bg-white rounded-xl flex items-center justify-center shadow-lg icon-badge overflow-hidden"
            >
              <img
                src="asset/logo.svg"
                alt="BIMS Logo"
                class="w-full h-full object-contain p-1"
              />
            </div>
            <div>
              <h1 class="text-xl font-black text-gray-800">BIMS</h1>
              <p class="text-sm text-gray-600 font-medium">SK Malanday</p>
            </div>
          </div>

          <!-- Navigation Menu -->
          <nav class="space-y-2">
            <a
              href="sk-dashboard.html"
              class="nav-link flex items-center space-x-3 px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg transition group"
            >
              <div
                class="w-9 h-9 bg-gray-100 rounded-lg flex items-center justify-center group-hover:bg-green-50 transition"
              >
                <svg
                  class="w-5 h-5 group-hover:text-green-600 transition"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3"
                  ></path>
                </svg>
              </div>
              <span>Dashboard</span>
            </a>
            <a
              href="sk-files.html"
              class="nav-link flex items-center space-x-3 px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg transition group"
            >
              <div
                class="w-9 h-9 bg-gray-100 rounded-lg flex items-center justify-center group-hover:bg-blue-50 transition"
              >
                <svg
                  class="w-5 h-5 group-hover:text-blue-600 transition"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                  ></path>
                </svg>
              </div>
              <span>Manage Files</span>
            </a>
            <a
              href="sk-projects.html"
              class="nav-link flex items-center space-x-3 px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg transition group"
            >
              <div
                class="w-9 h-9 bg-gray-100 rounded-lg flex items-center justify-center group-hover:bg-purple-50 transition"
              >
                <svg
                  class="w-5 h-5 group-hover:text-purple-600 transition"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                  ></path>
                </svg>
              </div>
              <span>Project Monitoring</span>
            </a>
            <a
              href="sk-calendar.html"
              class="nav-link flex items-center space-x-3 px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg transition group"
            >
              <div
                class="w-9 h-9 bg-gray-100 rounded-lg flex items-center justify-center group-hover:bg-orange-50 transition"
              >
                <svg
                  class="w-5 h-5 group-hover:text-orange-600 transition"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                  ></path>
                </svg>
              </div>
              <span>Calendar</span>
            </a>
            <a
              href="sk-testimonies.html"
              class="nav-link flex items-center space-x-3 px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg transition group"
            >
              <div
                class="w-9 h-9 bg-gray-100 rounded-lg flex items-center justify-center group-hover:bg-indigo-50 transition"
              >
                <svg
                  class="w-5 h-5 group-hover:text-indigo-600 transition"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
                  ></path>
                </svg>
              </div>
              <span>Testimonies</span>
            </a>
            <a
              href="sk-archive.html"
              class="nav-link flex items-center space-x-3 px-4 py-3 bg-[#2f6e4e]/10 text-[#2f6e4e] rounded-lg font-medium group"
            >
              <div
                class="w-9 h-9 bg-[#2f6e4e]/20 rounded-lg flex items-center justify-center group-hover:bg-[#2f6e4e]/30 transition"
              >
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  stroke-width="2.5"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"
                  ></path>
                </svg>
              </div>
              <span>Archives</span>
            </a>
          </nav>

          <div class="flex-1"></div>

          <!-- Logout -->
          <div class="mt-8 pt-8 border-t border-gray-200">
            <button
              class="nav-link flex items-center space-x-3 px-4 py-3 text-red-600 hover:bg-red-50 rounded-lg transition w-full group"
            >
              <div
                class="w-9 h-9 bg-red-50 rounded-lg flex items-center justify-center group-hover:bg-red-100 transition"
              >
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
                  ></path>
                </svg>
              </div>
              <span class="font-medium">Logout</span>
            </button>
          </div>
        </div>
      </aside>

      <!-- Main Content -->
      <div class="flex-1 overflow-y-auto">
        <!-- Header -->
        <header
          class="bg-gradient-to-r from-[#2f6e4e]/10 to-white border-b border-gray-200"
        >
          <div class="px-8 py-6">
            <div class="flex items-center justify-between">
              <div>
                <p
                  class="text-sm text-[#2f6e4e] font-semibold mb-1"
                  id="currentDate"
                >
                  Sunday, December 14, 2025
                </p>
                <h1 class="text-2xl font-bold text-gray-800">
                  Project Archives
                </h1>
                <p class="text-sm text-gray-600 mt-1">
                  Historical project records and comprehensive reports
                </p>
              </div>
              <div class="flex items-center space-x-4">
                <div class="relative">
                  <button
                    onclick="toggleNotificationModal()"
                    class="notification-icon p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition"
                    title="Notifications"
                  >
                    <svg
                      class="w-6 h-6"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"
                      ></path>
                    </svg>
                    <span
                      id="notificationBadge"
                      class="hidden absolute -top-1 -right-1 bg-gradient-to-br from-red-500 to-red-600 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center shadow-lg shadow-red-500/50 animate-pulse"
                      >5</span
                    >
                  </button>
                </div>
                <button
                  onclick="openProfileModal()"
                  class="flex items-center space-x-3 hover:bg-gray-100 rounded-lg px-3 py-2 transition-colors"
                >
                  <div class="text-right">
                    <p
                      class="text-sm font-medium text-gray-700 group-hover:text-[#2f6e4e] transition"
                    >
                      Andrea Pelias
                    </p>
                    <p class="text-xs text-gray-500">SK Chairman</p>
                  </div>
                  <div
                    class="w-10 h-10 bg-gradient-to-br from-[#2f6e4e] to-[#3d8b64] rounded-full flex items-center justify-center text-white font-semibold shadow-lg ring-2 ring-[#2f6e4e]/20 group-hover:ring-[#2f6e4e]/40 transition"
                  >
                    AP
                  </div>
                </button>
              </div>
            </div>
          </div>
        </header>

        <!-- Main Content Area -->
        <main class="p-8">
          <!-- Stats Overview -->
          <div class="grid grid-cols-1 md:grid-cols-5 gap-6 mb-8">
            <!-- Total Reports Card -->
            <div
              class="group bg-gradient-to-br from-blue-50 to-white rounded-2xl shadow-md hover:shadow-xl p-6 border-l-4 border-blue-500 transition-all duration-300 hover:-translate-y-1 cursor-pointer"
            >
              <div class="flex items-start justify-between mb-3">
                <div
                  class="w-14 h-14 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300"
                >
                  <svg
                    class="w-7 h-7 text-white"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    stroke-width="2.5"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                    ></path>
                  </svg>
                </div>
              </div>
              <p
                class="text-sm text-gray-600 font-semibold uppercase tracking-wide mb-1"
              >
                Total Reports
              </p>
              <p
                class="text-4xl font-extrabold text-gray-900 mb-1"
                id="totalReportsCount"
              >
                156
              </p>
              <p class="text-xs text-gray-500 flex items-center gap-1">
                <svg
                  class="w-3 h-3 text-green-500"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    fill-rule="evenodd"
                    d="M5.293 7.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L6.707 7.707a1 1 0 01-1.414 0z"
                    clip-rule="evenodd"
                  />
                </svg>
                Generated this year
              </p>
            </div>

            <!-- Archived Projects Card -->
            <div
              class="group bg-gradient-to-br from-green-50 to-white rounded-2xl shadow-md hover:shadow-xl p-6 border-l-4 border-[#2f6e4e] transition-all duration-300 hover:-translate-y-1 cursor-pointer"
            >
              <div class="flex items-start justify-between mb-3">
                <div
                  class="w-14 h-14 bg-gradient-to-br from-[#2f6e4e] to-[#3d8b64] rounded-xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300"
                >
                  <svg
                    class="w-7 h-7 text-white"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    stroke-width="2.5"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"
                    ></path>
                  </svg>
                </div>
              </div>
              <p
                class="text-sm text-gray-600 font-semibold uppercase tracking-wide mb-1"
              >
                Archived Projects
              </p>
              <p class="text-4xl font-extrabold text-gray-900 mb-1">38</p>
              <p class="text-xs text-gray-500">Completed & stored</p>
            </div>

            <!-- Total Budget Card -->
            <div
              class="group bg-gradient-to-br from-amber-50 to-white rounded-2xl shadow-md hover:shadow-xl p-6 border-l-4 border-amber-500 transition-all duration-300 hover:-translate-y-1 cursor-pointer"
            >
              <div class="flex items-start justify-between mb-3">
                <div
                  class="w-14 h-14 bg-gradient-to-br from-amber-500 to-amber-600 rounded-xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300"
                >
                  <svg
                    class="w-7 h-7 text-white"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    stroke-width="2.5"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                    ></path>
                  </svg>
                </div>
              </div>
              <p
                class="text-sm text-gray-600 font-semibold uppercase tracking-wide mb-1"
              >
                Total Budget
              </p>
              <p class="text-4xl font-extrabold text-gray-900 mb-1">₱1.2M</p>
              <p class="text-xs text-gray-500">Allocated funds</p>
            </div>

            <!-- Volunteers Card -->
            <div
              class="group bg-gradient-to-br from-purple-50 to-white rounded-2xl shadow-md hover:shadow-xl p-6 border-l-4 border-purple-500 transition-all duration-300 hover:-translate-y-1 cursor-pointer"
            >
              <div class="flex items-start justify-between mb-3">
                <div
                  class="w-14 h-14 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300"
                >
                  <svg
                    class="w-7 h-7 text-white"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    stroke-width="2.5"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"
                    ></path>
                  </svg>
                </div>
              </div>
              <p
                class="text-sm text-gray-600 font-semibold uppercase tracking-wide mb-1"
              >
                Volunteers
              </p>
              <p class="text-4xl font-extrabold text-gray-900 mb-1">287</p>
              <p class="text-xs text-gray-500">Active participants</p>
            </div>

            <!-- Success Rate Card -->
            <div
              class="group bg-gradient-to-br from-emerald-50 to-white rounded-2xl shadow-md hover:shadow-xl p-6 border-l-4 border-emerald-500 transition-all duration-300 hover:-translate-y-1 cursor-pointer"
            >
              <div class="flex items-start justify-between mb-3">
                <div
                  class="w-14 h-14 bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300"
                >
                  <svg
                    class="w-7 h-7 text-white"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    stroke-width="2.5"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"
                    ></path>
                  </svg>
                </div>
              </div>
              <p
                class="text-sm text-gray-600 font-semibold uppercase tracking-wide mb-1"
              >
                Success Rate
              </p>
              <p class="text-4xl font-extrabold text-gray-900 mb-1">89%</p>
              <p class="text-xs text-gray-500 flex items-center gap-1">
                <svg
                  class="w-3 h-3 text-emerald-500"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    fill-rule="evenodd"
                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                    clip-rule="evenodd"
                  />
                </svg>
                Above average
              </p>
            </div>
          </div>

          <!-- Archive Type Tabs -->
          <div class="bg-white rounded-xl shadow-sm mb-6">
            <div class="border-b border-gray-200">
              <nav class="flex -mb-px">
                <button
                  onclick="switchArchiveType('projects')"
                  id="projectsTab"
                  class="archive-type-tab active px-8 py-4 text-sm font-medium text-[#2f6e4e] border-b-2 border-[#2f6e4e] transition"
                >
                  <svg
                    class="w-5 h-5 inline mr-2"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                    ></path>
                  </svg>
                  Archived Projects
                  <span
                    class="ml-2 px-2 py-1 text-xs bg-[#2f6e4e]/20 rounded-full"
                    id="projectsCount"
                    >38</span
                  >
                </button>
                <button
                  onclick="switchArchiveType('files')"
                  id="filesTab"
                  class="archive-type-tab px-8 py-4 text-sm font-medium text-gray-500 hover:text-[#2f6e4e] hover:border-[#2f6e4e] border-b-2 border-transparent transition"
                >
                  <svg
                    class="w-5 h-5 inline mr-2"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                    ></path>
                  </svg>
                  Archived Files
                  <span
                    class="ml-2 px-2 py-1 text-xs bg-gray-100 rounded-full"
                    id="filesCount"
                    >0</span
                  >
                </button>
              </nav>
            </div>

            <!-- PROJECTS TAB CONTENT -->
            <div id="projectsTabContent" class="p-6">
              <!-- Quarter Summary -->
              <div
                id="quarterSummary"
                class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"
              >
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                  <p class="text-sm text-gray-500">Projects</p>
                  <p class="text-2xl font-bold text-gray-800 mt-1">8</p>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                  <p class="text-sm text-gray-500">Budget Used</p>
                  <p class="text-2xl font-bold text-gray-800 mt-1">₱285K</p>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                  <p class="text-sm text-gray-500">Volunteers</p>
                  <p class="text-2xl font-bold text-gray-800 mt-1">68</p>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                  <p class="text-sm text-gray-500">Avg Success</p>
                  <p class="text-2xl font-bold text-gray-800 mt-1">91%</p>
                </div>
              </div>

              <!-- Search and Filter Bar - PROJECTS -->
              <div class="bg-gray-50 rounded-xl p-6 mb-6">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                  <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2"
                      >Search Projects</label
                    >
                    <div class="relative">
                      <svg
                        class="w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                        ></path>
                      </svg>
                      <input
                        type="text"
                        id="searchInput"
                        placeholder="Search by project name..."
                        class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#3d8b64] focus:border-transparent"
                      />
                    </div>
                  </div>

                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2"
                      >Year</label
                    >
                    <select
                      id="yearFilter"
                      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#3d8b64] focus:border-transparent"
                    >
                      <option value="all">All Years</option>
                      <option value="2025" selected>2025</option>
                      <option value="2024">2024</option>
                      <option value="2023">2023</option>
                    </select>
                  </div>

                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2"
                      >Quarter</label
                    >
                    <select
                      id="quarterFilter"
                      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#3d8b64] focus:border-transparent"
                    >
                      <option value="all">All Quarters</option>
                      <option value="Q1">Q1 (Jan-Mar)</option>
                      <option value="Q2">Q2 (Apr-Jun)</option>
                      <option value="Q3">Q3 (Jul-Sep)</option>
                      <option value="Q4">Q4 (Oct-Dec)</option>
                    </select>
                  </div>
                </div>

                <div
                  class="flex items-center justify-end mt-4 pt-4 border-t border-gray-200"
                >
                  <button
                    onclick="resetFilters()"
                    class="text-sm text-[#2f6e4e] hover:text-[#2f6e4e] font-medium flex items-center"
                  >
                    <svg
                      class="w-4 h-4 mr-1"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                      stroke-width="2"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                      ></path>
                    </svg>
                    Reset Filters
                  </button>
                </div>
              </div>

              <!-- Bulk Report Download Section -->
              <div
                class="bg-gradient-to-r from-[#2f6e4e]/10 to-white rounded-xl p-6 mb-6 border border-[#2f6e4e]/20"
              >
                <div class="flex items-center justify-between">
                  <div>
                    <h3
                      class="text-lg font-bold text-gray-800 mb-1 flex items-center"
                    >
                      <svg
                        class="w-5 h-5 text-[#2f6e4e] mr-2"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
                        ></path>
                      </svg>
                      Generate Bulk Reports
                    </h3>
                    <p class="text-sm text-gray-600">
                      Download comprehensive reports for selected projects in
                      PDF format
                    </p>
                  </div>
                  <button
                    onclick="generateBulkReports()"
                    class="px-6 py-3 bg-[#2f6e4e] text-white rounded-lg hover:bg-[#2f6e4e] transition font-medium shadow-sm hover:shadow-md flex items-center"
                  >
                    <svg
                      class="w-5 h-5 mr-2"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                      stroke-width="2"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"
                      ></path>
                    </svg>
                    Download Selected Reports
                  </button>
                </div>

                <!-- Selection Info -->
                <div class="mt-4 pt-4 border-t border-[#2f6e4e]/30">
                  <div class="flex items-center justify-between text-sm">
                    <div class="flex items-center space-x-6">
                      <span class="text-gray-600 flex items-center">
                        <svg
                          class="w-4 h-4 text-[#2f6e4e] mr-1"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          stroke-width="2"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                          ></path>
                        </svg>
                        <span id="selectedCount">0</span> projects selected
                      </span>
                      <button
                        onclick="selectAllFiltered()"
                        class="text-[#2f6e4e] hover:text-[#2f6e4e] font-medium"
                      >
                        Select All Filtered
                      </button>
                      <button
                        onclick="deselectAll()"
                        class="text-gray-600 hover:text-gray-700 font-medium"
                      >
                        Deselect All
                      </button>
                    </div>
                    <span class="text-gray-500">
                      Click checkboxes on project cards to select for bulk
                      download
                    </span>
                  </div>
                </div>
              </div>

              <!-- Archived Projects List -->
              <div class="space-y-4" id="projectsList">
                <!-- Projects will be rendered here by JavaScript -->
              </div>

              <!-- Empty State (hidden by default) -->
              <div
                id="emptyState"
                class="hidden bg-white rounded-xl shadow-sm p-12 text-center"
              >
                <i class="fas fa-folder-open text-gray-300 text-6xl mb-4"></i>
                <h3 class="text-lg font-semibold text-gray-700 mb-2">
                  No Archived Projects Found
                </h3>
                <p class="text-gray-500">
                  Try adjusting your filters or search criteria
                </p>
              </div>
            </div>

            <!-- FILES TAB CONTENT -->
            <div id="filesTabContent" class="hidden p-6">
              <!-- Search and Filter Bar - FILES -->
              <div class="bg-gray-50 rounded-xl p-6 mb-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <div class="md:col-span-1">
                    <label class="block text-sm font-medium text-gray-700 mb-2"
                      >Search Files</label
                    >
                    <div class="relative">
                      <svg
                        class="w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                        ></path>
                      </svg>
                      <input
                        type="text"
                        id="fileSearchInput"
                        placeholder="Search by file name..."
                        class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#3d8b64] focus:border-transparent"
                      />
                    </div>
                  </div>

                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2"
                      >File Type</label
                    >
                    <select
                      id="fileTypeFilter"
                      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#3d8b64] focus:border-transparent"
                    >
                      <option value="all">All Types</option>
                      <option value="pdf">PDF</option>
                      <option value="xlsx">Excel (XLSX)</option>
                      <option value="jpg">Image (JPG)</option>
                      <option value="png">Image (PNG)</option>
                      <option value="doc">Document (DOC)</option>
                    </select>
                  </div>

                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2"
                      >Year</label
                    >
                    <select
                      id="fileYearFilter"
                      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#3d8b64] focus:border-transparent"
                    >
                      <option value="all">All Years</option>
                      <option value="2025" selected>2025</option>
                      <option value="2024">2024</option>
                      <option value="2023">2023</option>
                    </select>
                  </div>
                </div>

                <div
                  class="flex items-center justify-end mt-4 pt-4 border-t border-gray-200"
                >
                  <button
                    onclick="resetFileFilters()"
                    class="text-sm text-[#2f6e4e] hover:text-[#2f6e4e] font-medium flex items-center"
                  >
                    <svg
                      class="w-4 h-4 mr-1"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                      stroke-width="2"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                      ></path>
                    </svg>
                    Reset Filters
                  </button>
                </div>
              </div>

              <!-- Archived Files List -->
              <div id="filesList">
                <div
                  class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
                >
                  <!-- Files will be rendered here by JavaScript -->
                </div>
              </div>

              <!-- Empty State for Files -->
              <div
                id="emptyFilesState"
                class="hidden bg-white rounded-xl shadow-sm p-12 text-center"
              >
                <i class="fas fa-file text-gray-300 text-6xl mb-4"></i>
                <h3 class="text-lg font-semibold text-gray-700 mb-2">
                  No Archived Files Found
                </h3>
                <p class="text-gray-500">
                  Files older than 1 year will be automatically archived
                </p>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- Project Detail Modal -->
    <div
      id="projectModal"
      class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
    >
      <div
        class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto"
      >
        <div
          class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between"
        >
          <h2
            class="text-xl font-bold text-gray-800"
            id="modalProjectName"
          ></h2>
          <button
            onclick="closeModal()"
            class="text-gray-400 hover:text-gray-600"
          >
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>

        <div class="p-6">
          <!-- Project Metadata -->
          <div class="mb-6 pb-4 border-b border-gray-200">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
              <div>
                <p class="text-gray-500 font-medium">Category:</p>
                <p class="text-gray-800" id="modalCategory">Environment</p>
              </div>
              <div>
                <p class="text-gray-500 font-medium">Project Status:</p>
                <p class="text-gray-800">Completed</p>
              </div>
              <div>
                <p class="text-gray-500 font-medium">Generated:</p>
                <p class="text-gray-800" id="modalGenerated">
                  December 14, 2025
                </p>
              </div>
            </div>
          </div>

          <!-- Project Description -->
          <div class="mb-6">
            <h3 class="text-base font-bold text-gray-800 mb-3">
              Project Description
            </h3>
            <p class="text-gray-700 leading-relaxed" id="modalDescription"></p>
          </div>

          <!-- Project Details -->
          <div class="mb-6">
            <h3 class="text-base font-bold text-gray-800 mb-3">
              Project Details
            </h3>
            <div class="bg-gray-50 rounded-lg p-4 space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-gray-600 font-medium">Location:</span>
                <span class="text-gray-800" id="modalLocation"></span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600 font-medium">Project Heads:</span>
                <span class="text-gray-800" id="modalHeads"></span>
              </div>
            </div>
          </div>

          <!-- Project Schedule -->
          <div class="mb-6">
            <h3 class="text-base font-bold text-gray-800 mb-3">
              Project Schedule
            </h3>
            <div class="bg-gray-50 rounded-lg p-4 text-sm">
              <div class="flex justify-between">
                <span class="text-gray-600 font-medium">Date:</span>
                <span class="text-gray-800" id="modalPeriod"></span>
              </div>
            </div>
          </div>

          <!-- Volunteer Statistics -->
          <div class="mb-6">
            <h3 class="text-base font-bold text-gray-800 mb-3">
              Volunteer Statistics
            </h3>
            <div class="bg-gray-50 rounded-lg p-4 space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-gray-600 font-medium">Total Applicants</span>
                <span
                  class="text-gray-800 font-semibold"
                  id="modalTotalApplicants"
                ></span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600 font-medium"
                  >Approved Volunteers</span
                >
                <span
                  class="text-gray-800 font-semibold"
                  id="modalApprovedVolunteers"
                ></span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600 font-medium">Pending Review</span>
                <span
                  class="text-gray-800 font-semibold"
                  id="modalPendingReview"
                ></span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600 font-medium"
                  >Participation Rate</span
                >
                <span
                  class="text-gray-800 font-semibold"
                  id="modalParticipationRate"
                ></span>
              </div>
            </div>
          </div>

          <!-- Success Metrics -->
          <div class="mb-6">
            <h3 class="text-base font-bold text-gray-800 mb-3">
              Project Evaluation Summary
            </h3>
            <p class="text-sm text-gray-600 mb-4">
              (5-Factor Weighted Evaluation)
            </p>

            <!-- Table Header -->
            <div
              class="grid grid-cols-4 gap-4 text-sm mb-3 pb-2 border-b-2 border-gray-300"
            >
              <span class="text-gray-700 font-bold">Metric</span>
              <span class="text-gray-700 font-bold text-center">Score</span>
              <span class="text-gray-700 font-bold text-center">Weight</span>
              <span class="text-gray-700 font-bold text-center"
                >Contribution</span
              >
            </div>

            <div class="space-y-3" id="modalMetrics"></div>

            <div class="mt-4 pt-4 border-t border-gray-200">
              <div class="grid grid-cols-4 gap-4 items-center">
                <span class="font-bold text-gray-800"
                  >Overall Success Rate</span
                >
                <span
                  class="font-bold text-gray-800 text-center"
                  id="modalOverallSuccess"
                  >98%</span
                >
                <span class="font-semibold text-center">100%</span>
                <span
                  class="font-bold text-[#2f6e4e] text-center"
                  id="modalOverallContribution"
                  >97.25%</span
                >
              </div>
            </div>
          </div>

          <!-- Financial Summary -->
          <div class="mb-6">
            <h3 class="text-base font-bold text-gray-800 mb-3">
              Financial Summary
            </h3>
            <div class="bg-gray-50 rounded-lg p-4 space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-gray-600 font-medium">Planned Budget</span>
                <span
                  class="text-gray-800 font-semibold"
                  id="modalPlannedBudget"
                ></span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600 font-medium">Actual Spent</span>
                <span
                  class="text-gray-800 font-semibold"
                  id="modalActualSpent"
                ></span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600 font-medium">Budget Variance</span>
                <span
                  class="text-[#2f6e4e] font-semibold"
                  id="modalBudgetVariance"
                ></span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600 font-medium">Budget Efficiency</span>
                <span
                  class="text-gray-800 font-semibold"
                  id="modalBudgetEfficiency"
                ></span>
              </div>
            </div>
          </div>

          <!-- Budget Breakdown -->
          <div class="mb-6" id="modalBudgetBreakdownSection">
            <h3 class="text-base font-bold text-gray-800 mb-3">
              Budget Breakdown
            </h3>
            <div class="bg-gray-50 rounded-lg p-4">
              <div class="overflow-x-auto">
                <table class="min-w-full text-sm">
                  <thead>
                    <tr class="border-b border-gray-300">
                      <th
                        class="text-left py-2 px-3 font-semibold text-gray-700"
                      >
                        #
                      </th>
                      <th
                        class="text-left py-2 px-3 font-semibold text-gray-700"
                      >
                        Expense Item
                      </th>
                      <th
                        class="text-right py-2 px-3 font-semibold text-gray-700"
                      >
                        Cost
                      </th>
                    </tr>
                  </thead>
                  <tbody id="modalBudgetBreakdownList">
                    <!-- Budget breakdown rows will be inserted here -->
                  </tbody>
                  <tfoot>
                    <tr class="border-t-2 border-gray-300">
                      <td
                        colspan="2"
                        class="py-2 px-3 text-right font-bold text-gray-800"
                      >
                        Total:
                      </td>
                      <td
                        class="py-2 px-3 text-right font-bold text-[#2f6e4e]"
                        id="modalBudgetBreakdownTotal"
                      >
                        ₱0.00
                      </td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
          </div>

          <!-- Community Impact -->
          <div class="mb-6" id="modalCommunityImpact">
            <h3 class="text-base font-bold text-gray-800 mb-3">
              Community Impact
            </h3>
            <div class="bg-gray-50 rounded-lg p-4 space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-gray-600 font-medium"
                  >Target Beneficiaries</span
                >
                <span
                  class="text-gray-800 font-semibold"
                  id="modalTargetBeneficiaries"
                ></span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600 font-medium"
                  >Actual Beneficiaries</span
                >
                <span
                  class="text-gray-800 font-semibold"
                  id="modalActualBeneficiaries"
                ></span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600 font-medium"
                  >Community Engagement Level</span
                >
                <span
                  class="text-gray-800 font-semibold"
                  id="modalEngagementLevel"
                ></span>
              </div>
            </div>
          </div>

          <!-- Volunteer Feedback -->
          <div class="mb-6" id="modalFeedbackSection">
            <h3 class="text-base font-bold text-gray-800 mb-3">
              Volunteer Feedback
            </h3>
            <div class="bg-gray-50 rounded-lg p-4 space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-gray-600 font-medium"
                  >Feedback Submitted:</span
                >
                <span
                  class="text-gray-800 font-semibold"
                  id="modalFeedbackSubmitted"
                ></span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600 font-medium"
                  >Average Satisfaction Score:</span
                >
                <span
                  class="text-gray-800 font-semibold"
                  id="modalSatisfactionScore"
                ></span>
              </div>
              <div class="mt-2">
                <span class="text-gray-600 font-medium">Summary:</span>
                <p class="text-gray-700 mt-1" id="modalFeedbackSummary"></p>
              </div>
            </div>
          </div>

          <!-- Volunteer List -->
          <div class="mb-6">
            <h3 class="text-base font-bold text-gray-800 mb-3">
              List of Volunteers
            </h3>
            <div class="bg-gray-50 rounded-lg p-4">
              <div class="overflow-x-auto">
                <table class="min-w-full text-sm">
                  <thead>
                    <tr class="border-b border-gray-300">
                      <th
                        class="text-left py-2 px-3 font-semibold text-gray-700"
                      >
                        #
                      </th>
                      <th
                        class="text-left py-2 px-3 font-semibold text-gray-700"
                      >
                        Volunteer Name
                      </th>
                      <th
                        class="text-left py-2 px-3 font-semibold text-gray-700"
                      >
                        Age
                      </th>
                      <th
                        class="text-left py-2 px-3 font-semibold text-gray-700"
                      >
                        Contact Number
                      </th>
                    </tr>
                  </thead>
                  <tbody id="modalVolunteerList">
                    <!-- Volunteer rows will be inserted here -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Overall Success -->
          <div class="mb-6">
            <h3 class="text-base font-bold text-gray-800 mb-3">
              Overall Project Success Rate
            </h3>
            <div
              class="bg-[#2f6e4e]/10 border border-[#2f6e4e]/30 rounded-lg p-4"
            >
              <div class="flex items-center justify-center">
                <span
                  class="text-3xl font-bold text-[#2f6e4e]"
                  id="modalSuccessRateDisplay"
                ></span>
                <span
                  class="ml-2 text-lg text-[#2f6e4e] font-semibold"
                  id="modalSuccessLabel"
                  >– Highly Successful Project</span
                >
              </div>
              <p
                class="text-sm text-gray-700 mt-3 text-center"
                id="modalSuccessDescription"
              ></p>
            </div>
          </div>

          <!-- Actions -->
          <div
            class="flex justify-between items-center pt-4 border-t border-gray-200"
          >
            <button
              onclick="confirmPermanentDelete()"
              class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition"
            >
              <i class="fas fa-trash-alt mr-2"></i> Permanent Delete
            </button>
            <div class="flex space-x-3">
              <!-- Download Report Dropdown -->
              <div class="relative">
                <button
                  onclick="toggleDownloadMenu()"
                  class="px-4 py-2 bg-[#2f6e4e] text-white rounded-lg hover:bg-[#2f6e4e] transition flex items-center"
                >
                  <i class="fas fa-download mr-2"></i> Download Report
                  <i class="fas fa-chevron-down ml-2 text-xs"></i>
                </button>
                <div
                  id="downloadMenu"
                  class="hidden absolute bottom-full mb-2 right-0 bg-white rounded-lg shadow-xl border border-gray-200 py-2 min-w-[180px] z-50"
                >
                  <button
                    onclick="exportProject('pdf')"
                    class="w-full text-left px-4 py-2 hover:bg-gray-50 flex items-center space-x-2"
                  >
                    <i class="fas fa-file-pdf text-red-600"></i>
                    <span class="text-gray-700">PDF Document</span>
                  </button>
                  <button
                    onclick="exportProject('csv')"
                    class="w-full text-left px-4 py-2 hover:bg-gray-50 flex items-center space-x-2"
                  >
                    <i class="fas fa-file-csv text-green-600"></i>
                    <span class="text-gray-700">CSV Spreadsheet</span>
                  </button>
                  <button
                    onclick="exportProject('txt')"
                    class="w-full text-left px-4 py-2 hover:bg-gray-50 flex items-center space-x-2"
                  >
                    <i class="fas fa-file-alt text-blue-600"></i>
                    <span class="text-gray-700">Text Document</span>
                  </button>
                </div>
              </div>
              <button
                onclick="closeModal()"
                class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition"
              >
                Close
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- DELETE CONFIRMATION MODAL -->
    <div
      id="deleteConfirmModal"
      class="hidden fixed inset-0 z-[70] overflow-y-auto"
    >
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-gray-900 opacity-75"></div>

        <div class="relative bg-white rounded-xl shadow-2xl max-w-md w-full">
          <!-- Header with Warning -->
          <div class="bg-red-600 p-6 rounded-t-xl">
            <div class="flex items-center gap-3">
              <div
                class="w-12 h-12 bg-white rounded-full flex items-center justify-center"
              >
                <i
                  class="fas fa-exclamation-triangle text-red-600 text-2xl"
                ></i>
              </div>
              <div>
                <h3 class="text-xl font-bold text-white">Permanent Delete</h3>
                <p class="text-red-100 text-sm">
                  This action cannot be undone!
                </p>
              </div>
            </div>
          </div>

          <!-- Content -->
          <div class="p-6">
            <div class="mb-6">
              <p class="text-gray-700 mb-4">
                Are you sure you want to <strong>permanently delete</strong>:
              </p>
              <div
                class="bg-gray-50 border border-gray-200 rounded-lg p-3 mb-4"
              >
                <p
                  class="font-semibold text-gray-900"
                  id="deleteProjectName"
                ></p>
              </div>
              <p class="text-sm text-gray-600 mb-4">
                This project will be removed from the archive and cannot be
                recovered.
              </p>
            </div>

            <div class="mb-6">
              <label
                class="block text-sm font-semibold text-gray-700 mb-3 text-center"
              >
                To confirm, type
                <span class="text-red-600 font-mono font-bold">DELETE</span> in
                capital letters:
              </label>

              <!-- OTP-Style Delete Input -->
              <div class="flex justify-center gap-2 mb-3">
                <input
                  type="text"
                  maxlength="1"
                  id="deleteChar0"
                  data-index="0"
                  class="delete-input w-12 h-14 text-center text-2xl font-bold border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 uppercase"
                  style="text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1)"
                  autocomplete="off"
                />
                <input
                  type="text"
                  maxlength="1"
                  id="deleteChar1"
                  data-index="1"
                  class="delete-input w-12 h-14 text-center text-2xl font-bold border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 uppercase"
                  style="text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1)"
                  autocomplete="off"
                />
                <input
                  type="text"
                  maxlength="1"
                  id="deleteChar2"
                  data-index="2"
                  class="delete-input w-12 h-14 text-center text-2xl font-bold border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 uppercase"
                  style="text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1)"
                  autocomplete="off"
                />
                <input
                  type="text"
                  maxlength="1"
                  id="deleteChar3"
                  data-index="3"
                  class="delete-input w-12 h-14 text-center text-2xl font-bold border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 uppercase"
                  style="text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1)"
                  autocomplete="off"
                />
                <input
                  type="text"
                  maxlength="1"
                  id="deleteChar4"
                  data-index="4"
                  class="delete-input w-12 h-14 text-center text-2xl font-bold border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 uppercase"
                  style="text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1)"
                  autocomplete="off"
                />
                <input
                  type="text"
                  maxlength="1"
                  id="deleteChar5"
                  data-index="5"
                  class="delete-input w-12 h-14 text-center text-2xl font-bold border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 uppercase"
                  style="text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1)"
                  autocomplete="off"
                />
              </div>

              <!-- Placeholder letters below each input -->
              <div class="flex justify-center gap-2 mb-3">
                <div class="w-12 text-center text-xs text-gray-400 font-mono">
                  D
                </div>
                <div class="w-12 text-center text-xs text-gray-400 font-mono">
                  E
                </div>
                <div class="w-12 text-center text-xs text-gray-400 font-mono">
                  L
                </div>
                <div class="w-12 text-center text-xs text-gray-400 font-mono">
                  E
                </div>
                <div class="w-12 text-center text-xs text-gray-400 font-mono">
                  T
                </div>
                <div class="w-12 text-center text-xs text-gray-400 font-mono">
                  E
                </div>
              </div>

              <p
                id="deleteErrorMsg"
                class="hidden text-sm text-red-600 mt-2 text-center"
              >
                <i class="fas fa-exclamation-circle mr-1"></i>
                Please type "DELETE" exactly to confirm
              </p>
            </div>
          </div>

          <!-- Footer -->
          <div class="bg-gray-50 px-6 py-4 rounded-b-xl flex justify-end gap-3">
            <button
              onclick="closeDeleteModal()"
              class="px-6 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition font-medium"
            >
              Cancel
            </button>
            <button
              id="deleteSubmitBtn"
              onclick="executeDelete()"
              disabled
              class="px-6 py-2.5 bg-gray-300 text-gray-500 rounded-lg cursor-not-allowed transition font-medium"
            >
              <i class="fas fa-trash-alt mr-2"></i>
              Delete Permanently
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Restore File Confirmation Modal -->
    <div
      id="restoreFileModal"
      class="hidden fixed inset-0 z-[70] overflow-y-auto"
    >
      <div class="flex items-center justify-center min-h-screen px-4">
        <div
          class="fixed inset-0 bg-gray-900 opacity-75"
          onclick="closeRestoreFileModal()"
        ></div>

        <div class="relative bg-white rounded-xl shadow-2xl max-w-md w-full">
          <!-- Header -->
          <div class="bg-[#2f6e4e] p-6 rounded-t-xl">
            <div class="flex items-center gap-3">
              <div
                class="w-12 h-12 bg-white rounded-full flex items-center justify-center"
              >
                <svg
                  class="w-6 h-6 text-[#2f6e4e]"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"
                  ></path>
                </svg>
              </div>
              <div>
                <h3 class="text-xl font-bold text-white">Restore File</h3>
                <p class="text-green-100 text-sm">
                  Move file back to active files
                </p>
              </div>
            </div>
          </div>

          <!-- Content -->
          <div class="p-6">
            <p class="text-gray-700 mb-4">
              Are you sure you want to restore this file?
            </p>
            <div class="bg-gray-50 border border-gray-200 rounded-lg p-3 mb-4">
              <p class="font-semibold text-gray-900" id="restoreFileName"></p>
            </div>
            <p class="text-sm text-gray-600">
              This file will be moved back to the active files section.
            </p>
          </div>

          <!-- Footer -->
          <div class="bg-gray-50 px-6 py-4 rounded-b-xl flex justify-end gap-3">
            <button
              onclick="closeRestoreFileModal()"
              class="px-6 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition font-medium"
            >
              Cancel
            </button>
            <button
              onclick="confirmRestoreFile()"
              class="px-6 py-2.5 bg-[#2f6e4e] text-white rounded-lg hover:bg-[#3d8b64] transition font-medium"
            >
              <svg
                class="w-5 h-5 inline mr-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"
                ></path>
              </svg>
              Restore File
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Delete Archived File Confirmation Modal -->
    <div
      id="deleteArchivedFileModal"
      class="hidden fixed inset-0 z-[70] overflow-y-auto"
    >
      <div class="flex items-center justify-center min-h-screen px-4">
        <div
          class="fixed inset-0 bg-gray-900 opacity-75"
          onclick="closeDeleteArchivedFileModal()"
        ></div>

        <div class="relative bg-white rounded-xl shadow-2xl max-w-md w-full">
          <!-- Header -->
          <div class="bg-red-600 p-6 rounded-t-xl">
            <div class="flex items-center gap-3">
              <div
                class="w-12 h-12 bg-white rounded-full flex items-center justify-center"
              >
                <svg
                  class="w-6 h-6 text-red-600"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
                  ></path>
                </svg>
              </div>
              <div>
                <h3 class="text-xl font-bold text-white">Permanent Delete</h3>
                <p class="text-red-100 text-sm">
                  This action cannot be undone!
                </p>
              </div>
            </div>
          </div>

          <!-- Content -->
          <div class="p-6">
            <p class="text-gray-700 mb-4">
              Are you sure you want to <strong>permanently delete</strong> this
              file?
            </p>
            <div class="bg-gray-50 border border-gray-200 rounded-lg p-3 mb-4">
              <p
                class="font-semibold text-gray-900"
                id="deleteArchivedFileName"
              ></p>
            </div>
            <p class="text-sm text-red-600 font-medium">
              ⚠️ This file will be permanently deleted and cannot be recovered.
            </p>
          </div>

          <!-- Footer -->
          <div class="bg-gray-50 px-6 py-4 rounded-b-xl flex justify-end gap-3">
            <button
              onclick="closeDeleteArchivedFileModal()"
              class="px-6 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition font-medium"
            >
              Cancel
            </button>
            <button
              onclick="confirmDeleteArchivedFile()"
              class="px-6 py-2.5 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-medium"
            >
              <svg
                class="w-5 h-5 inline mr-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                ></path>
              </svg>
              Delete Permanently
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- View Archived File Modal -->
    <div id="viewArchivedFileModal" class="hidden fixed inset-0 z-[70] overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-gray-900 opacity-75" onclick="closeViewArchivedFileModal()"></div>
        <div class="relative bg-white rounded-xl shadow-2xl max-w-2xl w-full">
          <!-- Header -->
          <div class="bg-[#2f6e4e] p-6 rounded-t-xl">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center">
                  <svg class="w-6 h-6 text-[#2f6e4e]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                  </svg>
                </div>
                <div>
                  <h3 id="viewArchivedFileTitle" class="text-xl font-bold text-white truncate max-w-md">File Preview</h3>
                  <p class="text-green-100 text-sm">Archived file</p>
                </div>
              </div>
              <button onclick="closeViewArchivedFileModal()" class="text-white hover:text-green-200 transition">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
              </button>
            </div>
          </div>
          <!-- Content -->
          <div class="p-6">
            <div class="grid grid-cols-2 gap-4 mb-4 text-sm">
              <div><span class="text-gray-500">File Name:</span> <span id="viewArchivedFileName" class="font-medium text-gray-800"></span></div>
              <div><span class="text-gray-500">Uploaded:</span> <span id="viewArchivedFileDate" class="font-medium text-gray-800"></span></div>
            </div>
            <!-- Preview area -->
            <div class="bg-gray-50 rounded-lg p-4 min-h-[200px] flex items-center justify-center">
              <div id="viewArchivedFileLoading" class="text-center">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-[#2f6e4e] mx-auto mb-2"></div>
                <p class="text-gray-500 text-sm">Loading preview...</p>
              </div>
              <div id="viewArchivedFilePreview" class="hidden w-full">
                <img id="viewArchivedFileImg" class="hidden max-h-96 mx-auto rounded-lg" alt="File preview" />
                <canvas id="archivedPdfCanvas" class="hidden max-h-96 mx-auto rounded-lg"></canvas>
              </div>
              <div id="viewArchivedFileIcon" class="hidden text-center">
                <div id="viewArchivedFileIconBg" class="w-20 h-20 rounded-xl flex items-center justify-center mx-auto mb-3 bg-gray-100 text-gray-600">
                  <span id="viewArchivedFileTypeLabel" class="text-2xl font-bold"></span>
                </div>
                <p class="text-gray-500 text-sm">Preview not available for this file type</p>
              </div>
            </div>
          </div>
          <!-- Footer -->
          <div class="bg-gray-50 px-6 py-4 rounded-b-xl flex justify-end gap-3">
            <button onclick="closeViewArchivedFileModal()" class="px-6 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition font-medium">Close</button>
            <a id="viewArchivedFileDownload" href="#" download class="px-6 py-2.5 bg-[#2f6e4e] text-white rounded-lg hover:bg-[#3d8b64] transition font-medium inline-flex items-center">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
              Download
            </a>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Sample archived projects data
      const archivedProjects = [
        {
          id: 1,
          name: "Community Clean-Up Drive 2025: Malanday River Rehabilitation",
          quarter: "Q4",
          year: 2025,
          category: "Environment",
          period: "Dec 2, 2025 – Dec 2, 2025",
          startDate: "2025-12-02",
          budget: 30000,
          spent: 29400,
          volunteers: 38,
          totalApplicants: 40,
          approvedVolunteers: 38,
          pendingReview: 2,
          successRate: 98,
          budgetScore: 98,
          participationScore: 95,
          timelineScore: 100,
          impactScore: 96,
          feedbackScore: 97,
          feedbackSubmitted: 36,
          avgSatisfaction: 4.9,
          targetBeneficiaries: 200,
          actualBeneficiaries: 240,
          communityEngagement: "High",
          location: "Malanday River and surrounding areas",
          heads: ["Andrea Pelias", "Kyleen Nicdao"],
          description:
            "A comprehensive environmental initiative focused on rehabilitating the Malanday River system through organized clean-up operations, waste segregation education, tree-planting activities, and active community participation. The project aimed to promote environmental responsibility among residents while addressing long-standing waste accumulation issues along the riverbanks.",
          achievements: [
            "Collected 2 tons of waste",
            "Engaged 38 active volunteers",
            "Cleaned entire Malanday River stretch",
            "240 community members benefited",
            "Volunteers reported excellent coordination",
          ],
          budgetBreakdown: [
            {
              id: 1,
              description: "Cleaning supplies and equipment",
              cost: 7000,
            },
            { id: 2, description: "Trash bags and waste bins", cost: 3000 },
            { id: 3, description: "Refreshments for volunteers", cost: 4500 },
            {
              id: 4,
              description: "Tree saplings and planting materials",
              cost: 6500,
            },
            {
              id: 5,
              description: "Signage and educational materials",
              cost: 3500,
            },
            { id: 6, description: "First aid supplies", cost: 1800 },
            { id: 7, description: "Transportation and logistics", cost: 2600 },
            { id: 8, description: "Documentation (photos/videos)", cost: 1500 },
          ],
          volunteerList: [
            { name: "Juan Dela Cruz", age: 19, contact: "0912-345-6789" },
            { name: "Maria Santos", age: 21, contact: "0923-456-7890" },
            { name: "Pedro Garcia", age: 18, contact: "0934-567-8901" },
            { name: "Ana Reyes", age: 20, contact: "0945-678-9012" },
            { name: "Miguel Torres", age: 22, contact: "0956-789-0123" },
            { name: "Sofia Ramos", age: 19, contact: "0967-890-1234" },
            { name: "Carlos Mendoza", age: 21, contact: "0978-901-2345" },
            { name: "Isabel Cruz", age: 18, contact: "0989-012-3456" },
            { name: "Diego Lopez", age: 20, contact: "0910-123-4567" },
            { name: "Camila Flores", age: 19, contact: "0921-234-5678" },
            { name: "Lucas Rivera", age: 22, contact: "0932-345-6789" },
            { name: "Valentina Morales", age: 21, contact: "0943-456-7890" },
            { name: "Mateo Castillo", age: 19, contact: "0954-567-8901" },
            { name: "Emma Navarro", age: 20, contact: "0965-678-9012" },
            { name: "Gabriel Herrera", age: 18, contact: "0976-789-0123" },
            { name: "Olivia Jimenez", age: 21, contact: "0987-890-1234" },
            { name: "Sebastian Ruiz", age: 19, contact: "0998-901-2345" },
            { name: "Mia Gutierrez", age: 22, contact: "0909-012-3456" },
            { name: "Daniel Ortiz", age: 20, contact: "0920-123-4567" },
            { name: "Luna Diaz", age: 19, contact: "0931-234-5678" },
            { name: "Adrian Vargas", age: 21, contact: "0942-345-6789" },
            { name: "Zoe Fernandez", age: 18, contact: "0953-456-7890" },
            { name: "Ethan Ramirez", age: 20, contact: "0964-567-8901" },
            { name: "Chloe Martinez", age: 19, contact: "0975-678-9012" },
            { name: "Ryan Alvarez", age: 22, contact: "0986-789-0123" },
            { name: "Lily Sanchez", age: 21, contact: "0997-890-1234" },
            { name: "Nathan Gomez", age: 19, contact: "0908-901-2345" },
            { name: "Grace Perez", age: 20, contact: "0919-012-3456" },
            { name: "Aaron Tan", age: 18, contact: "0930-123-4567" },
            { name: "Hannah Lim", age: 21, contact: "0941-234-5678" },
            { name: "Joshua Ong", age: 19, contact: "0952-345-6789" },
            { name: "Sarah Lee", age: 22, contact: "0963-456-7890" },
            { name: "David Chua", age: 20, contact: "0974-567-8901" },
            { name: "Rachel Sy", age: 19, contact: "0985-678-9012" },
            { name: "Matthew Go", age: 21, contact: "0996-789-0123" },
            { name: "Jessica Uy", age: 18, contact: "0907-890-1234" },
            { name: "Andrew Yap", age: 20, contact: "0918-901-2345" },
            { name: "Nicole Dy", age: 19, contact: "0929-012-3456" },
          ],
        },
        {
          id: 2,
          name: "Youth Leadership Summit",
          quarter: "Q4",
          year: 2025,
          period: "Oct 20-22, 2025",
          budget: 45000,
          spent: 42000,
          volunteers: 60,
          successRate: 92,
          budgetScore: 93,
          participationScore: 95,
          timelineScore: 90,
          impactScore: 88,
          feedbackScore: 94,
          description:
            "Three-day leadership training for SK officers and youth leaders.",
          achievements: [
            "Trained 60 youth leaders",
            "5 expert speakers",
            "Leadership certification",
            "92% completion rate",
          ],
        },
      ];

      let currentQuarter = "Q4";
      let filteredProjects = [...archivedProjects];

      // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        renderProjects();
        attachFilterListeners();
      });

      function renderProjects() {
        const projectsList = document.getElementById("projectsList");
        const emptyState = document.getElementById("emptyState");

        if (filteredProjects.length === 0) {
          projectsList.innerHTML = "";
          emptyState.classList.remove("hidden");
          return;
        }

        emptyState.classList.add("hidden");

        projectsList.innerHTML = filteredProjects
          .map(
            (project) => `
                <div class="bg-white rounded-xl shadow-sm hover:shadow-md transition p-6 border border-gray-100 ${
                  selectedProjects.includes(project.id)
                    ? "ring-2 ring-[#3d8b64]"
                    : ""
                }">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center space-x-3 flex-1">
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox"
                                       class="w-5 h-5 text-[#2f6e4e] rounded focus:ring-[#3d8b64] cursor-pointer"
                                       ${
                                         selectedProjects.includes(project.id)
                                           ? "checked"
                                           : ""
                                       }
                                       onchange="toggleProjectSelection(${
                                         project.id
                                       })">
                            </label>
                            <div class="flex-1">
                                <div class="flex items-center space-x-3 mb-2">
                                    <h3 class="text-lg font-bold text-gray-800">${
                                      project.name
                                    }</h3>
                                    <span class="px-3 py-1 text-xs font-semibold rounded-full ${getSuccessBadgeClass(
                                      project.successRate,
                                    )}">
                                        ${project.successRate}% Success
                                    </span>
                                </div>
                                <div class="flex items-center space-x-4 text-sm text-gray-500">
                                    <span><i class="far fa-calendar mr-1"></i> ${
                                      project.period
                                    }</span>
                                    <span><i class="fas fa-tag mr-1"></i> ${
                                      project.quarter
                                    } ${project.year}</span>
                                </div>
                            </div>
                        </div>
                        <button onclick="viewProject(${
                          project.id
                        })" class="px-4 py-2 bg-[#2f6e4e] text-white text-sm rounded-lg hover:bg-[#2f6e4e] transition">
                            <i class="fas fa-eye mr-1"></i> View Details
                        </button>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                        <div class="bg-gray-50 rounded-lg p-3">
                            <p class="text-xs text-gray-500 mb-1">Budget</p>
                            <p class="font-semibold text-gray-800">₱${project.budget.toLocaleString()}</p>
                            <p class="text-xs text-gray-500">Spent: ₱${project.spent.toLocaleString()}</p>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-3">
                            <p class="text-xs text-gray-500 mb-1">Volunteers</p>
                            <p class="font-semibold text-gray-800">${
                              project.volunteers
                            }</p>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-3">
                            <p class="text-xs text-gray-500 mb-1">Budget Efficiency</p>
                            <p class="font-semibold text-gray-800">${
                              project.budgetScore
                            }%</p>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-3">
                            <p class="text-xs text-gray-500 mb-1">Impact Score</p>
                            <p class="font-semibold text-gray-800">${
                              project.impactScore
                            }%</p>
                        </div>
                    </div>

                    <div class="space-y-2">
                        <div class="flex items-center justify-between text-xs">
                            <span class="text-gray-600">Overall Success Rate</span>
                            <span class="font-semibold text-gray-800">${
                              project.successRate
                            }%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="h-2 rounded-full ${getSuccessBarClass(
                              project.successRate,
                            )}" style="width: ${project.successRate}%"></div>
                        </div>
                    </div>
                </div>
            `,
          )
          .join("");
      }

      function getSuccessBadgeClass(rate) {
        if (rate >= 90) return "bg-green-100 text-green-700";
        if (rate >= 80) return "bg-blue-100 text-blue-700";
        if (rate >= 70) return "bg-yellow-100 text-yellow-700";
        return "bg-red-100 text-red-700";
      }

      function getSuccessBarClass(rate) {
        if (rate >= 90) return "bg-green-500";
        if (rate >= 80) return "bg-blue-500";
        if (rate >= 70) return "bg-yellow-500";
        return "bg-red-500";
      }

      // Toast Notification System
      function showToast(message, type = "success") {
        const existingToast = document.querySelector(".toast");
        if (existingToast) {
          existingToast.remove();
        }

        const toast = document.createElement("div");
        toast.className = `toast ${type}`;

        const icons = {
          success:
            '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>',
          error:
            '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',
          warning:
            '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>',
          info: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',
        };

        toast.innerHTML = `
                <div class="toast-icon">${icons[type]}</div>
                <div class="toast-message">${message}</div>
            `;

        const styles = document.createElement("style");
        if (!document.getElementById("toast-styles")) {
          styles.id = "toast-styles";
          styles.textContent = `
                    .toast {
                        position: fixed;
                        top: 24px;
                        right: 24px;
                        min-width: 300px;
                        max-width: 500px;
                        padding: 16px;
                        border-radius: 12px;
                        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        z-index: 10000;
                        transform: translateX(400px);
                        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                        font-family: 'Inter', sans-serif;
                    }
                    .toast.show {
                        transform: translateX(0);
                    }
                    .toast.success {
                        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                        color: white;
                    }
                    .toast.error {
                        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
                        color: white;
                    }
                    .toast.warning {
                        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
                        color: white;
                    }
                    .toast.info {
                        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
                        color: white;
                    }
                    .toast-icon {
                        flex-shrink: 0;
                        width: 20px;
                        height: 20px;
                    }
                    .toast-message {
                        flex: 1;
                        font-size: 14px;
                        font-weight: 500;
                        line-height: 1.5;
                    }
                `;
          document.head.appendChild(styles);
        }

        document.body.appendChild(toast);

        setTimeout(() => {
          toast.classList.add("show");
        }, 10);

        setTimeout(() => {
          toast.classList.remove("show");
          setTimeout(() => {
            toast.remove();
          }, 300);
        }, 4000);
      }

      function switchQuarter(quarter) {
        currentQuarter = quarter;

        // Update active tab
        document.querySelectorAll(".quarter-tab").forEach((tab) => {
          tab.classList.remove("active", "text-[#2f6e4e]", "border-[#2f6e4e]");
          tab.classList.add("text-gray-500", "border-transparent");
        });
        event.target.classList.add(
          "active",
          "text-[#2f6e4e]",
          "border-[#2f6e4e]",
        );
        event.target.classList.remove("text-gray-500", "border-transparent");

        // Update quarter filter
        document.getElementById("quarterFilter").value = quarter;

        applyFilters();
      }

      function attachFilterListeners() {
        document
          .getElementById("searchInput")
          .addEventListener("input", applyFilters);
        document
          .getElementById("yearFilter")
          .addEventListener("change", applyFilters);
        document
          .getElementById("quarterFilter")
          .addEventListener("change", applyFilters);

        // File filter listeners
        document
          .getElementById("fileSearchInput")
          .addEventListener("input", renderArchivedFiles);
        document
          .getElementById("fileTypeFilter")
          .addEventListener("change", renderArchivedFiles);
        document
          .getElementById("fileYearFilter")
          .addEventListener("change", renderArchivedFiles);
      }

      function applyFilters() {
        const search = document
          .getElementById("searchInput")
          .value.toLowerCase();
        const year = document.getElementById("yearFilter").value;
        const quarter = document.getElementById("quarterFilter").value;

        filteredProjects = archivedProjects.filter((project) => {
          const matchesSearch = project.name.toLowerCase().includes(search);
          const matchesYear =
            year === "all" || project.year.toString() === year;
          const matchesQuarter =
            quarter === "all" || project.quarter === quarter;

          return matchesSearch && matchesYear && matchesQuarter;
        });

        renderProjects();
        updateQuarterSummary();
      }

      function updateQuarterSummary() {
        const quarterProjects = filteredProjects.filter(
          (p) => p.quarter === currentQuarter,
        );
        const totalBudget = quarterProjects.reduce(
          (sum, p) => sum + p.spent,
          0,
        );
        const totalVolunteers = quarterProjects.reduce(
          (sum, p) => sum + p.volunteers,
          0,
        );
        const avgSuccess =
          quarterProjects.length > 0
            ? Math.round(
                quarterProjects.reduce((sum, p) => sum + p.successRate, 0) /
                  quarterProjects.length,
              )
            : 0;

        document.getElementById("quarterSummary").innerHTML = `
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                    <p class="text-sm text-gray-500">Projects</p>
                    <p class="text-2xl font-bold text-gray-800 mt-1">${
                      quarterProjects.length
                    }</p>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                    <p class="text-sm text-gray-500">Budget Used</p>
                    <p class="text-2xl font-bold text-gray-800 mt-1">₱${(
                      totalBudget / 1000
                    ).toFixed(0)}K</p>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                    <p class="text-sm text-gray-500">Volunteers</p>
                    <p class="text-2xl font-bold text-gray-800 mt-1">${totalVolunteers}</p>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                    <p class="text-sm text-gray-500">Avg Success</p>
                    <p class="text-2xl font-bold text-gray-800 mt-1">${avgSuccess}%</p>
                </div>
            `;
      }

      function resetFilters() {
        document.getElementById("searchInput").value = "";
        document.getElementById("yearFilter").value = "2025";
        document.getElementById("quarterFilter").value = "all";
        applyFilters();
      }

      function resetFileFilters() {
        document.getElementById("fileSearchInput").value = "";
        document.getElementById("fileTypeFilter").value = "all";
        document.getElementById("fileYearFilter").value = "2025";
        renderArchivedFiles();
      }

      function viewProject(id) {
        const project = archivedProjects.find((p) => p.id === id);
        if (!project) return;

        // Store current project for export
        currentProjectForExport = project;

        // Basic Info
        document.getElementById("modalProjectName").textContent = project.name;
        document.getElementById("modalCategory").textContent =
          project.category || "General";
        document.getElementById("modalGenerated").textContent =
          new Date().toLocaleDateString("en-US", {
            year: "numeric",
            month: "long",
            day: "numeric",
          });
        document.getElementById("modalDescription").textContent =
          project.description;

        // Project Details
        document.getElementById("modalLocation").textContent =
          project.location || "Barangay Malanday";
        document.getElementById("modalHeads").textContent = project.heads
          ? project.heads.join(", ")
          : "N/A";
        document.getElementById("modalPeriod").textContent = project.period;

        // Volunteer Statistics
        const totalApplicants = project.totalApplicants || project.volunteers || 0;
        const approvedVolunteers = project.approvedVolunteers || project.volunteers || 0;
        document.getElementById("modalTotalApplicants").textContent =
          totalApplicants || "N/A";
        document.getElementById("modalApprovedVolunteers").textContent =
          approvedVolunteers || "N/A";
        document.getElementById("modalPendingReview").textContent =
          project.pendingReview || "0";
        // Use participationScore (consistent with PDF report and metrics)
        // Fall back to calculating from approved/total only if score isn't available
        const participationRate = project.participationScore
          ? `${project.participationScore}%`
          : totalApplicants > 0
            ? Math.round((approvedVolunteers / totalApplicants) * 100) + "%"
            : "N/A";
        document.getElementById("modalParticipationRate").textContent =
          participationRate;

        // Metrics with Contribution Calculation
        const metrics = [
          { name: "Budget Efficiency", score: project.budgetScore, weight: 25 },
          {
            name: "Volunteer Participation",
            score: project.participationScore,
            weight: 20,
          },
          {
            name: "Timeline Adherence",
            score: project.timelineScore,
            weight: 20,
          },
          { name: "Community Impact", score: project.impactScore, weight: 20 },
          {
            name: "Volunteer Feedback",
            score: project.feedbackScore,
            weight: 15,
          },
        ];

        const totalContribution = metrics.reduce(
          (sum, m) => sum + (m.score * m.weight) / 100,
          0,
        );

        document.getElementById("modalMetrics").innerHTML = metrics
          .map((m) => {
            const contribution = ((m.score * m.weight) / 100).toFixed(2);
            return `
                <div>
                    <div class="grid grid-cols-4 gap-4 text-sm mb-1">
                        <span class="text-gray-800 font-medium col-span-1">${
                          m.name
                        }</span>
                        <span class="text-gray-800 font-semibold text-center">${
                          m.score
                        }%</span>
                        <span class="text-gray-600 text-center">${
                          m.weight
                        }%</span>
                        <span class="text-gray-800 font-semibold text-center">${contribution}%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="h-2 rounded-full ${getSuccessBarClass(
                          m.score,
                        )}" style="width: ${m.score}%"></div>
                    </div>
                </div>
            `;
          })
          .join("");

        document.getElementById("modalOverallSuccess").textContent =
          project.successRate + "%";
        document.getElementById("modalOverallContribution").textContent =
          totalContribution.toFixed(2) + "%";

        // Financial Summary
        document.getElementById("modalPlannedBudget").textContent =
          `₱${project.budget.toLocaleString()}`;
        document.getElementById("modalActualSpent").textContent =
          `₱${project.spent.toLocaleString()}`;
        const variance = project.budget - project.spent;
        document.getElementById("modalBudgetVariance").textContent =
          `±${variance.toLocaleString()} (${
            variance >= 0 ? "Under Budget" : "Over Budget"
          })`;
        document.getElementById("modalBudgetEfficiency").textContent =
          project.budgetScore + "%";

        // Budget Breakdown
        const budgetBreakdownListEl = document.getElementById(
          "modalBudgetBreakdownList",
        );
        const budgetBreakdownSectionEl = document.getElementById(
          "modalBudgetBreakdownSection",
        );
        if (project.budgetBreakdown && project.budgetBreakdown.length > 0) {
          budgetBreakdownSectionEl.style.display = "block";
          budgetBreakdownListEl.innerHTML = project.budgetBreakdown
            .map(
              (item, index) => `
                    <tr class="border-b border-gray-200 hover:bg-gray-50">
                        <td class="py-2 px-3 text-gray-700">${index + 1}</td>
                        <td class="py-2 px-3 text-gray-800 font-medium">${
                          item.description
                        }</td>
                        <td class="py-2 px-3 text-gray-700 text-right">₱${item.cost.toLocaleString(
                          "en-US",
                          {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2,
                          },
                        )}</td>
                    </tr>
                `,
            )
            .join("");

          const totalBreakdown = project.budgetBreakdown.reduce(
            (sum, item) => sum + (item.cost || 0),
            0,
          );
          document.getElementById("modalBudgetBreakdownTotal").textContent =
            `₱${totalBreakdown.toLocaleString("en-US", {
              minimumFractionDigits: 2,
              maximumFractionDigits: 2,
            })}`;
        } else {
          budgetBreakdownSectionEl.style.display = "none";
        }

        // Community Impact
        if (
          project.targetBeneficiaries ||
          project.actualBeneficiaries ||
          project.communityEngagement
        ) {
          document.getElementById("modalTargetBeneficiaries").textContent =
            project.targetBeneficiaries || "N/A";
          document.getElementById("modalActualBeneficiaries").textContent =
            project.actualBeneficiaries || "N/A";
          document.getElementById("modalEngagementLevel").textContent =
            project.communityEngagement || "N/A";
        } else {
          document.getElementById("modalCommunityImpact").style.display =
            "none";
        }

        // Volunteer Feedback
        if (project.feedbackSubmitted || project.avgSatisfaction) {
          const feedbackText =
            project.approvedVolunteers && project.feedbackSubmitted
              ? `${project.feedbackSubmitted} / ${project.approvedVolunteers} volunteers`
              : project.feedbackSubmitted || "N/A";
          document.getElementById("modalFeedbackSubmitted").textContent =
            feedbackText;
          document.getElementById("modalSatisfactionScore").textContent =
            project.avgSatisfaction
              ? project.avgSatisfaction + " / 5.0"
              : "N/A";

          const feedbackSummary =
            project.achievements && project.achievements.length > 3
              ? project.achievements[project.achievements.length - 1]
              : "Volunteers reported positive experience and strong community cooperation throughout the activity.";
          document.getElementById("modalFeedbackSummary").textContent =
            feedbackSummary;
        } else {
          document.getElementById("modalFeedbackSection").style.display =
            "none";
        }

        // Volunteer List
        const volunteerListEl = document.getElementById("modalVolunteerList");
        if (project.volunteerList && project.volunteerList.length > 0) {
          volunteerListEl.innerHTML = project.volunteerList
            .map(
              (volunteer, index) => `
                    <tr class="border-b border-gray-200 hover:bg-gray-50">
                        <td class="py-2 px-3 text-gray-700">${index + 1}</td>
                        <td class="py-2 px-3 text-gray-800 font-medium">${
                          volunteer.name
                        }</td>
                        <td class="py-2 px-3 text-gray-700">${
                          volunteer.age
                        }</td>
                        <td class="py-2 px-3 text-gray-700">${
                          volunteer.contact
                        }</td>
                    </tr>
                `,
            )
            .join("");
        } else {
          volunteerListEl.innerHTML = `
                    <tr>
                        <td colspan="4" class="py-4 px-3 text-center text-gray-500">No volunteer data available</td>
                    </tr>
                `;
        }

        // Overall Success
        document.getElementById("modalSuccessRateDisplay").textContent =
          project.successRate + "%";

        let successLabel = "";
        if (project.successRate >= 90)
          successLabel = "– Highly Successful Project";
        else if (project.successRate >= 75)
          successLabel = "– Successful Project";
        else if (project.successRate >= 60)
          successLabel = "– Moderately Successful";
        else successLabel = "– Needs Improvement";

        document.getElementById("modalSuccessLabel").textContent = successLabel;

        const successDesc = `The project achieved an overall success rate of ${
          project.successRate
        }%, indicating ${
          project.successRate >= 90 ? "excellent" : "good"
        } performance across all evaluation criteria. Strong budget efficiency, high volunteer participation, on-time completion, positive community impact, and very favorable volunteer feedback collectively contributed to the project's high success rating.`;
        document.getElementById("modalSuccessDescription").textContent =
          successDesc;

        document.getElementById("projectModal").classList.remove("hidden");
      }

      function confirmPermanentDelete() {
        if (!currentProjectForExport) return;

        // Show the custom delete confirmation modal
        document.getElementById("deleteProjectName").textContent =
          currentProjectForExport.name;

        // Clear all character inputs
        for (let i = 0; i < 6; i++) {
          document.getElementById(`deleteChar${i}`).value = "";
        }

        document.getElementById("deleteErrorMsg").classList.add("hidden");
        document
          .getElementById("deleteConfirmModal")
          .classList.remove("hidden");

        // Focus on first input field
        setTimeout(() => {
          document.getElementById("deleteChar0").focus();
        }, 100);
      }

      function closeDeleteModal() {
        document.getElementById("deleteConfirmModal").classList.add("hidden");

        // Clear all character inputs
        for (let i = 0; i < 6; i++) {
          document.getElementById(`deleteChar${i}`).value = "";
        }

        document.getElementById("deleteErrorMsg").classList.add("hidden");
      }

      function executeDelete() {
        // Collect all characters
        let userInput = "";
        for (let i = 0; i < 6; i++) {
          userInput += document.getElementById(`deleteChar${i}`).value;
        }

        const errorMsg = document.getElementById("deleteErrorMsg");

        if (userInput === "DELETE") {
          const projectName = currentProjectForExport.name;

          // Remove from array
          const index = archivedProjects.findIndex(
            (p) => p.id === currentProjectForExport.id,
          );
          if (index !== -1) {
            archivedProjects.splice(index, 1);
            closeDeleteModal();
            closeModal();
            filterProjects();

            // Show success message
            showToast(
              `Project "${projectName}" has been permanently deleted.`,
              "success",
            );
          }
        } else {
          // Show error message
          errorMsg.classList.remove("hidden");

          // Shake animation for error
          const inputs = document.querySelectorAll(".delete-input");
          inputs.forEach((input) => {
            input.style.animation = "shake 0.3s";
            setTimeout(() => {
              input.style.animation = "";
            }, 300);
          });

          // Clear inputs and focus first
          for (let i = 0; i < 6; i++) {
            document.getElementById(`deleteChar${i}`).value = "";
          }
          document.getElementById("deleteChar0").focus();
        }
      }

      // Update delete button state
      function updateDeleteButtonState() {
        const deleteBtn = document.getElementById("deleteSubmitBtn");
        let allFilled = true;

        for (let i = 0; i < 6; i++) {
          if (!document.getElementById(`deleteChar${i}`).value) {
            allFilled = false;
            break;
          }
        }

        if (allFilled) {
          deleteBtn.disabled = false;
          deleteBtn.className =
            "px-6 py-2.5 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-medium cursor-pointer";
        } else {
          deleteBtn.disabled = true;
          deleteBtn.className =
            "px-6 py-2.5 bg-gray-300 text-gray-500 rounded-lg cursor-not-allowed transition font-medium";
        }
      }

      // OTP-style input handling
      document.addEventListener("DOMContentLoaded", function () {
        const deleteInputs = document.querySelectorAll(".delete-input");

        deleteInputs.forEach((input, index) => {
          // Move to next input on type
          input.addEventListener("input", function (e) {
            const value = this.value.toUpperCase();
            this.value = value;

            if (value && index < 5) {
              document.getElementById(`deleteChar${index + 1}`).focus();
            }

            // Update button state
            updateDeleteButtonState();
          });

          // Handle backspace to move to previous input
          input.addEventListener("keydown", function (e) {
            if (e.key === "Backspace") {
              if (!this.value && index > 0) {
                document.getElementById(`deleteChar${index - 1}`).focus();
              }
              // Update button state after backspace
              setTimeout(() => updateDeleteButtonState(), 10);
            }

            // Handle Enter key
            if (e.key === "Enter") {
              executeDelete();
            }
          });

          // Prevent paste
          input.addEventListener("paste", function (e) {
            e.preventDefault();
            const pastedText = (e.clipboardData || window.clipboardData)
              .getData("text")
              .toUpperCase();

            // Fill all boxes if pasting "DELETE"
            if (pastedText === "DELETE") {
              for (let i = 0; i < 6; i++) {
                document.getElementById(`deleteChar${i}`).value = pastedText[i];
              }
              updateDeleteButtonState();
            }
          });
        });
      });

      function closeModal() {
        document.getElementById("projectModal").classList.add("hidden");
        // Close download menu if open
        document.getElementById("downloadMenu").classList.add("hidden");
      }

      function toggleDownloadMenu() {
        const menu = document.getElementById("downloadMenu");
        menu.classList.toggle("hidden");
      }

      // Close dropdown when clicking outside
      document.addEventListener("click", function (event) {
        const menu = document.getElementById("downloadMenu");
        if (menu && !event.target.closest(".relative")) {
          menu.classList.add("hidden");
        }
      });

      let currentProjectForExport = null;

      function exportProject(format = "pdf") {
        if (!currentProjectForExport) return;

        // Close the download menu
        document.getElementById("downloadMenu").classList.add("hidden");

        if (format === "pdf") {
          exportAsPDF();
        } else if (format === "csv") {
          exportAsCSV();
        } else if (format === "txt") {
          exportAsText();
        }
      }

      function exportAsPDF() {
        if (!currentProjectForExport) return;

        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const project = currentProjectForExport;

        let y = 15;
        const pageWidth = 210;
        const pageHeight = 297;
        const margin = 20;
        const contentWidth = pageWidth - margin * 2;

        // Helper function to add new page if needed
        function checkPageBreak(neededSpace = 20) {
          if (y + neededSpace > pageHeight - 20) {
            doc.addPage();
            y = 20;
            return true;
          }
          return false;
        }

        // Helper to draw section header
        function drawSectionHeader(title) {
          checkPageBreak(15);
          doc.setFillColor(5, 150, 105); // [#2f6e4e]
          doc.rect(margin, y - 3, contentWidth, 8, "F");
          doc.setTextColor(255, 255, 255);
          doc.setFontSize(12);
          doc.setFont(undefined, "bold");
          doc.text(title, margin + 2, y + 2);
          doc.setTextColor(0, 0, 0);
          y += 12;
        }

        // Title Header with background
        doc.setFillColor(5, 150, 105);
        doc.rect(0, 0, pageWidth, 35, "F");

        doc.setTextColor(255, 255, 255);
        doc.setFontSize(16);
        doc.setFont(undefined, "bold");
        const titleLines = doc.splitTextToSize(project.name, contentWidth);
        titleLines.forEach((line, idx) => {
          doc.text(line, pageWidth / 2, 12 + idx * 7, { align: "center" });
        });

        doc.setFontSize(10);
        doc.setFont(undefined, "normal");
        doc.text("PROJECT COMPLETION REPORT", pageWidth / 2, 28, {
          align: "center",
        });

        doc.setTextColor(0, 0, 0);
        y = 45;

        // Metadata Box
        doc.setDrawColor(5, 150, 105);
        doc.setLineWidth(0.5);
        doc.rect(margin, y, contentWidth, 20);

        doc.setFontSize(9);
        doc.setFont(undefined, "bold");
        doc.text("Category:", margin + 3, y + 6);
        doc.setFont(undefined, "normal");
        doc.text(project.category || "N/A", margin + 25, y + 6);

        doc.setFont(undefined, "bold");
        doc.text("Status:", margin + 3, y + 12);
        doc.setFont(undefined, "normal");
        doc.text("Completed", margin + 25, y + 12);

        doc.setFont(undefined, "bold");
        doc.text("Generated:", margin + 3, y + 18);
        doc.setFont(undefined, "normal");
        doc.text(
          new Date().toLocaleDateString("en-US", {
            month: "long",
            day: "numeric",
            year: "numeric",
          }),
          margin + 25,
          y + 18,
        );

        y += 28;

        // Project Description Section
        drawSectionHeader("Project Description");

        doc.setFontSize(10);
        doc.setFont(undefined, "normal");
        const descLines = doc.splitTextToSize(
          project.description,
          contentWidth,
        );
        descLines.forEach((line) => {
          checkPageBreak();
          doc.text(line, margin, y);
          y += 5;
        });
        y += 10;

        // Project Details Section
        drawSectionHeader("Project Details");

        doc.setFontSize(10);
        doc.setFont(undefined, "bold");
        doc.text("Location:", margin + 2, y);
        doc.setFont(undefined, "normal");
        doc.text(project.location || "N/A", margin + 30, y);
        y += 6;

        doc.setFont(undefined, "bold");
        doc.text("Project Heads:", margin + 2, y);
        doc.setFont(undefined, "normal");
        const headsText =
          project.heads && project.heads.length > 0
            ? project.heads.join(", ")
            : "N/A";
        doc.text(headsText, margin + 35, y);
        y += 6;

        doc.setFont(undefined, "bold");
        doc.text("Date:", margin + 2, y);
        doc.setFont(undefined, "normal");
        doc.text(project.period, margin + 30, y);
        y += 12;

        // Volunteer Statistics
        drawSectionHeader("Volunteer Statistics");

        doc.setFontSize(10);
        const stats = [
          ["Total Applicants", project.totalApplicants || project.volunteers],
          [
            "Approved Volunteers",
            project.approvedVolunteers || project.volunteers,
          ],
          ["Pending Review", project.pendingReview || 0],
          ["Participation Rate", `${project.participationScore || 0}%`],
        ];

        stats.forEach(([label, value]) => {
          checkPageBreak();
          doc.setFont(undefined, "bold");
          doc.text(label, margin + 2, y);
          doc.setFont(undefined, "normal");
          doc.text(String(value), margin + 60, y);
          y += 6;
        });
        y += 10;

        // List of Volunteers Table
        if (project.volunteerList && project.volunteerList.length > 0) {
          drawSectionHeader("List of Volunteers");

          // Table headers
          doc.setFillColor(240, 240, 240);
          doc.rect(margin, y, contentWidth, 7, "F");

          doc.setFontSize(9);
          doc.setFont(undefined, "bold");
          doc.text("#", margin + 2, y + 5);
          doc.text("Volunteer Name", margin + 10, y + 5);
          doc.text("Age", margin + 100, y + 5);
          doc.text("Contact Number", margin + 120, y + 5);
          y += 7;

          doc.setFont(undefined, "normal");
          doc.setDrawColor(200, 200, 200);
          doc.setLineWidth(0.1);

          project.volunteerList.forEach((volunteer, index) => {
            checkPageBreak(8);

            // Alternate row colors
            if (index % 2 === 0) {
              doc.setFillColor(250, 250, 250);
              doc.rect(margin, y - 1, contentWidth, 6, "F");
            }

            doc.text(String(index + 1), margin + 2, y + 4);
            doc.text(volunteer.name, margin + 10, y + 4);
            doc.text(String(volunteer.age), margin + 100, y + 4);
            doc.text(volunteer.contact, margin + 120, y + 4);

            // Draw row separator
            doc.line(margin, y + 5, margin + contentWidth, y + 5);

            y += 6;
          });

          y += 8;
        }

        // Project Evaluation Summary
        drawSectionHeader("Project Evaluation Summary (5-Factor Weighted)");

        const evaluationMetrics = [
          [
            "Budget Efficiency",
            project.budgetScore,
            "25%",
            (project.budgetScore * 0.25).toFixed(2),
          ],
          [
            "Volunteer Participation",
            project.participationScore,
            "20%",
            (project.participationScore * 0.2).toFixed(2),
          ],
          [
            "Timeline Adherence",
            project.timelineScore,
            "20%",
            (project.timelineScore * 0.2).toFixed(2),
          ],
          [
            "Community Impact",
            project.impactScore,
            "20%",
            (project.impactScore * 0.2).toFixed(2),
          ],
          [
            "Volunteer Feedback",
            project.feedbackScore,
            "15%",
            (project.feedbackScore * 0.15).toFixed(2),
          ],
        ];

        // Table header
        doc.setFillColor(240, 240, 240);
        doc.rect(margin, y, contentWidth, 7, "F");

        doc.setFontSize(9);
        doc.setFont(undefined, "bold");
        doc.text("Metric", margin + 2, y + 5);
        doc.text("Score", margin + 80, y + 5);
        doc.text("Weight", margin + 110, y + 5);
        doc.text("Contribution", margin + 140, y + 5);
        y += 7;

        doc.setFont(undefined, "normal");
        evaluationMetrics.forEach(
          ([metric, score, weight, contribution], idx) => {
            checkPageBreak();

            if (idx % 2 === 0) {
              doc.setFillColor(250, 250, 250);
              doc.rect(margin, y - 1, contentWidth, 6, "F");
            }

            doc.text(metric, margin + 2, y + 4);
            doc.text(`${score}%`, margin + 80, y + 4);
            doc.text(weight, margin + 110, y + 4);
            doc.text(`${contribution}%`, margin + 140, y + 4);

            doc.line(margin, y + 5, margin + contentWidth, y + 5);
            y += 6;
          },
        );

        // Total row
        doc.setFillColor(5, 150, 105);
        doc.rect(margin, y - 1, contentWidth, 7, "F");
        doc.setTextColor(255, 255, 255);
        doc.setFont(undefined, "bold");
        doc.text("Overall Success Rate", margin + 2, y + 4);
        doc.text(`${project.successRate}%`, margin + 80, y + 4);
        doc.text("100%", margin + 110, y + 4);
        const totalContribution = evaluationMetrics
          .reduce((sum, m) => sum + parseFloat(m[3]), 0)
          .toFixed(2);
        doc.text(`${totalContribution}%`, margin + 140, y + 4);
        doc.setTextColor(0, 0, 0);
        y += 12;

        // Financial Summary
        drawSectionHeader("Financial Summary");

        doc.setFontSize(10);
        const variance = project.budget - project.spent;
        const financialData = [
          ["Planned Budget", `₱${project.budget.toLocaleString()}`],
          ["Actual Spent", `₱${project.spent.toLocaleString()}`],
          [
            "Budget Variance",
            `₱${variance.toLocaleString()} (${
              variance >= 0 ? "Under" : "Over"
            } Budget)`,
          ],
          ["Budget Efficiency", `${project.budgetScore}%`],
        ];

        financialData.forEach(([label, value]) => {
          checkPageBreak();
          doc.setFont(undefined, "bold");
          doc.text(label, margin + 2, y);
          doc.setFont(undefined, "normal");
          doc.text(value, margin + 60, y);
          y += 6;
        });
        y += 10;

        // Budget Breakdown
        if (project.budgetBreakdown && project.budgetBreakdown.length > 0) {
          drawSectionHeader("Budget Breakdown");

          // Table headers
          doc.setFillColor(240, 240, 240);
          doc.rect(margin, y, contentWidth, 7, "F");

          doc.setFontSize(9);
          doc.setFont(undefined, "bold");
          doc.text("#", margin + 2, y + 5);
          doc.text("Expense Item", margin + 10, y + 5);
          doc.text("Cost", margin + 150, y + 5);
          y += 7;

          doc.setFont(undefined, "normal");
          doc.setDrawColor(200, 200, 200);
          doc.setLineWidth(0.1);

          let totalBreakdown = 0;
          project.budgetBreakdown.forEach((item, index) => {
            checkPageBreak(8);

            // Alternate row colors
            if (index % 2 === 0) {
              doc.setFillColor(250, 250, 250);
              doc.rect(margin, y - 1, contentWidth, 6, "F");
            }

            doc.text(String(index + 1), margin + 2, y + 4);
            doc.text(item.description, margin + 10, y + 4);
            doc.text(
              `₱${item.cost.toLocaleString("en-US", {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2,
              })}`,
              margin + 150,
              y + 4,
            );

            totalBreakdown += item.cost;

            // Draw row separator
            doc.line(margin, y + 5, margin + contentWidth, y + 5);

            y += 6;
          });

          // Total row
          doc.setFillColor(240, 240, 240);
          doc.rect(margin, y, contentWidth, 7, "F");
          doc.setFont(undefined, "bold");
          doc.text("Total:", margin + 120, y + 5);
          doc.text(
            `₱${totalBreakdown.toLocaleString("en-US", {
              minimumFractionDigits: 2,
              maximumFractionDigits: 2,
            })}`,
            margin + 150,
            y + 5,
          );
          doc.setFont(undefined, "normal");
          y += 10;
        }

        // Community Impact
        drawSectionHeader("Community Impact");

        doc.setFontSize(10);
        const communityData = [
          ["Target Beneficiaries", project.targetBeneficiaries || "N/A"],
          ["Actual Beneficiaries", project.actualBeneficiaries || "N/A"],
          ["Community Engagement Level", project.communityEngagement || "N/A"],
        ];

        communityData.forEach(([label, value]) => {
          checkPageBreak();
          doc.setFont(undefined, "bold");
          doc.text(label, margin + 2, y);
          doc.setFont(undefined, "normal");
          doc.text(String(value), margin + 60, y);
          y += 6;
        });
        y += 10;

        // Volunteer Feedback
        drawSectionHeader("Volunteer Feedback");

        doc.setFontSize(10);
        doc.setFont(undefined, "bold");
        doc.text("Feedback Submitted:", margin + 2, y);
        doc.setFont(undefined, "normal");
        doc.text(
          `${project.feedbackSubmitted || 0} / ${
            project.approvedVolunteers || project.volunteers
          } volunteers`,
          margin + 50,
          y,
        );
        y += 6;

        doc.setFont(undefined, "bold");
        doc.text("Average Satisfaction Score:", margin + 2, y);
        doc.setFont(undefined, "normal");
        doc.text(`${project.avgSatisfaction || "N/A"} / 5.0`, margin + 65, y);
        y += 6;

        doc.setFont(undefined, "bold");
        doc.text("Summary:", margin + 2, y);
        y += 5;
        doc.setFont(undefined, "normal");
        const summaryText =
          "Volunteers reported excellent coordination, clear task delegation, and strong community cooperation throughout the activity.";
        const summaryLines = doc.splitTextToSize(summaryText, contentWidth - 4);
        summaryLines.forEach((line) => {
          checkPageBreak();
          doc.text(line, margin + 2, y);
          y += 5;
        });
        y += 10;

        // Overall Project Success Rate
        drawSectionHeader("Overall Project Success Rate");

        // Success box
        doc.setFillColor(220, 252, 231); // [#2f6e4e]/10
        doc.setDrawColor(5, 150, 105);
        doc.setLineWidth(1);
        doc.rect(margin, y, contentWidth, 20, "FD");

        doc.setFontSize(16);
        doc.setFont(undefined, "bold");
        doc.setTextColor(5, 150, 105);
        doc.text(
          `${project.successRate}% – Highly Successful Project`,
          pageWidth / 2,
          y + 8,
          { align: "center" },
        );
        doc.setTextColor(0, 0, 0);
        y += 24;

        doc.setFontSize(10);
        doc.setFont(undefined, "normal");
        const conclusionText = `The project achieved an overall success rate of ${project.successRate}%, indicating excellent performance across all evaluation criteria. Strong budget efficiency, high volunteer participation, on-time completion, positive community impact, and very favorable volunteer feedback collectively contributed to the project's high success rating.`;
        const conclusionLines = doc.splitTextToSize(
          conclusionText,
          contentWidth,
        );
        conclusionLines.forEach((line) => {
          checkPageBreak();
          doc.text(line, margin, y);
          y += 5;
        });
        y += 10;

        // Footer
        checkPageBreak(15);
        doc.setDrawColor(200, 200, 200);
        doc.line(margin, y, margin + contentWidth, y);
        y += 5;

        doc.setFontSize(9);
        doc.setTextColor(100, 100, 100);
        doc.setFont(undefined, "italic");
        doc.text(
          "Report generated by BIMS – Barangay Information Management System",
          margin,
          y,
        );
        y += 4;
        doc.text(
          `Generated on: ${new Date().toLocaleDateString("en-US", {
            month: "long",
            day: "numeric",
            year: "numeric",
            hour: "2-digit",
            minute: "2-digit",
          })}`,
          margin,
          y,
        );
        doc.setTextColor(0, 0, 0);

        // Save PDF
        doc.save(`${project.name.replace(/[^a-zA-Z0-9]/g, "_")}_Report.pdf`);
        closeModal();
      }

      function exportAsText() {
        if (!currentProjectForExport) return;
        const project = currentProjectForExport;

        // Create text content
        let textContent = "";
        textContent +=
          "═══════════════════════════════════════════════════════════\n";
        textContent +=
          "                    PROJECT REPORT                         \n";
        textContent +=
          "═══════════════════════════════════════════════════════════\n\n";

        textContent +=
          "┌─────────────────────────────────────────────────────────┐\n";
        textContent +=
          "│ PROJECT INFORMATION                                     │\n";
        textContent +=
          "└─────────────────────────────────────────────────────────┘\n";
        textContent += `Project Name: ${project.name}\n`;
        textContent += `Category: ${project.category}\n`;
        textContent += `Period: ${project.period}\n`;
        textContent += `Status: ${project.status}\n\n`;

        textContent +=
          "┌─────────────────────────────────────────────────────────┐\n";
        textContent +=
          "│ BUDGET INFORMATION                                      │\n";
        textContent +=
          "└─────────────────────────────────────────────────────────┘\n";
        textContent += `Proposed Budget: ₱${project.budget.toLocaleString()}\n`;
        textContent += `Total Spent: ₱${project.spent.toLocaleString()}\n`;
        textContent += `Balance: ₱${(
          project.budget - project.spent
        ).toLocaleString()}\n\n`;

        textContent +=
          "┌─────────────────────────────────────────────────────────┐\n";
        textContent +=
          "│ PARTICIPATION METRICS                                   │\n";
        textContent +=
          "└─────────────────────────────────────────────────────────┘\n";
        textContent += `Target Volunteers: ${project.targetVolunteers}\n`;
        textContent += `Actual Volunteers: ${project.actualVolunteers}\n`;
        textContent += `Target Beneficiaries: ${project.targetBeneficiaries}\n`;
        textContent += `Actual Beneficiaries: ${project.actualBeneficiaries}\n\n`;

        textContent +=
          "┌─────────────────────────────────────────────────────────┐\n";
        textContent +=
          "│ SUCCESS RATE                                            │\n";
        textContent +=
          "└─────────────────────────────────────────────────────────┘\n";
        textContent += `Overall Success Rate: ${project.successRate}%\n\n`;

        textContent +=
          "┌─────────────────────────────────────────────────────────┐\n";
        textContent +=
          "│ DESCRIPTION                                             │\n";
        textContent +=
          "└─────────────────────────────────────────────────────────┘\n";
        textContent += `${project.description}\n\n`;

        textContent +=
          "┌─────────────────────────────────────────────────────────┐\n";
        textContent +=
          "│ TEAM HEADS                                              │\n";
        textContent +=
          "└─────────────────────────────────────────────────────────┘\n";
        project.heads.forEach((head, index) => {
          textContent += `${index + 1}. ${head}\n`;
        });
        textContent += "\n";

        // Add budget breakdown if available
        if (project.budgetBreakdown && project.budgetBreakdown.length > 0) {
          textContent +=
            "┌─────────────────────────────────────────────────────────┐\n";
          textContent +=
            "│ BUDGET BREAKDOWN                                        │\n";
          textContent +=
            "└─────────────────────────────────────────────────────────┘\n";
          project.budgetBreakdown.forEach((item, index) => {
            textContent += `${index + 1}. ${item.description.padEnd(
              40,
            )} ₱${item.cost.toLocaleString()}\n`;
          });
          const totalBreakdown = project.budgetBreakdown.reduce(
            (sum, item) => sum + item.cost,
            0,
          );
          textContent += `${"─".repeat(57)}\n`;
          textContent += `${"TOTAL:".padEnd(
            43,
          )} ₱${totalBreakdown.toLocaleString()}\n\n`;
        }

        // Add volunteers list if available
        if (project.volunteers && project.volunteers.length > 0) {
          textContent +=
            "┌─────────────────────────────────────────────────────────┐\n";
          textContent +=
            "│ VOLUNTEERS LIST                                         │\n";
          textContent +=
            "└─────────────────────────────────────────────────────────┘\n";
          project.volunteers.forEach((vol, index) => {
            textContent += `${(index + 1)
              .toString()
              .padStart(3)}. ${vol.name.padEnd(25)} Age: ${vol.age
              .toString()
              .padStart(2)}  ${vol.contact}\n`;
          });
          textContent += "\n";
        }

        textContent +=
          "═══════════════════════════════════════════════════════════\n";
        textContent += `Generated on: ${new Date().toLocaleString()}\n`;
        textContent +=
          "═══════════════════════════════════════════════════════════\n";

        // Download as text file
        const blob = new Blob([textContent], {
          type: "text/plain;charset=utf-8;",
        });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `${project.name.replace(/[^a-zA-Z0-9]/g, "_")}_Report.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        closeModal();
      }

      function exportAsCSV() {
        if (!currentProjectForExport) return;
        const project = currentProjectForExport;

        // Create CSV data
        const rows = [
          ["Project Report"],
          [""],
          ["Project Name", project.name],
          ["Category", project.category],
          ["Period", project.period],
          ["Status", project.status],
          [""],
          ["Budget Information"],
          ["Proposed Budget", `₱${project.budget.toLocaleString()}`],
          ["Total Spent", `₱${project.spent.toLocaleString()}`],
          [""],
          ["Participation"],
          ["Target Volunteers", project.targetVolunteers],
          ["Actual Volunteers", project.actualVolunteers],
          ["Target Beneficiaries", project.targetBeneficiaries],
          ["Actual Beneficiaries", project.actualBeneficiaries],
          [""],
          ["Success Rate", `${project.successRate}%`],
          [""],
          ["Description", project.description],
          [""],
          ["Team Heads"],
        ];

        // Add team heads
        project.heads.forEach((head, index) => {
          rows.push([`${index + 1}`, head]);
        });

        // Add budget breakdown if available
        if (project.budgetBreakdown && project.budgetBreakdown.length > 0) {
          rows.push([""], ["Budget Breakdown"], ["#", "Expense Item", "Cost"]);
          project.budgetBreakdown.forEach((item, index) => {
            rows.push([
              index + 1,
              item.description,
              `₱${item.cost.toLocaleString()}`,
            ]);
          });
        }

        // Add volunteers list if available
        if (project.volunteers && project.volunteers.length > 0) {
          rows.push([""], ["Volunteers List"], ["#", "Name", "Age", "Contact"]);
          project.volunteers.forEach((vol, index) => {
            rows.push([index + 1, vol.name, vol.age, vol.contact]);
          });
        }

        // Convert to CSV
        const csvContent = rows
          .map((row) =>
            row
              .map((cell) => `"${String(cell).replace(/"/g, '""')}"`)
              .join(","),
          )
          .join("\n");

        // Download CSV
        const blob = new Blob([csvContent], {
          type: "text/csv;charset=utf-8;",
        });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `${project.name.replace(/[^a-zA-Z0-9]/g, "_")}_Report.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        closeModal();
      }

      // Bulk Report Download Functions
      let selectedProjects = [];

      function toggleProjectSelection(projectId) {
        if (selectedProjects.includes(projectId)) {
          selectedProjects = selectedProjects.filter((id) => id !== projectId);
        } else {
          selectedProjects.push(projectId);
        }
        updateSelectedCount();
        renderProjects();
      }

      function updateSelectedCount() {
        document.getElementById("selectedCount").textContent =
          selectedProjects.length;
      }

      function selectAllFiltered() {
        selectedProjects = filteredProjects.map((p) => p.id);
        updateSelectedCount();
        renderProjects();
      }

      function deselectAll() {
        selectedProjects = [];
        updateSelectedCount();
        renderProjects();
      }

      async function generateBulkReports() {
        if (selectedProjects.length === 0) {
          showToast(
            "Please select at least one project to generate reports.",
            "warning",
          );
          return;
        }

        showConfirm(
          "Download Reports",
          `Generate and download ${selectedProjects.length} PDF report(s)?`,
          async () => {
            const { jsPDF } = window.jspdf;

            // Show progress
            const selectedProjectsList = archivedProjects.filter((p) =>
              selectedProjects.includes(p.id),
            );

            for (let i = 0; i < selectedProjectsList.length; i++) {
              const project = selectedProjectsList[i];

              // Generate PDF for each project (reuse export logic)
              const doc = new jsPDF();
              let y = 20;
              const lineHeight = 7;

              // Title
              doc.setFontSize(18);
              doc.setFont(undefined, "bold");
              doc.text(project.name, 105, y, { align: "center" });
              y += lineHeight + 3;

              // Metadata
              doc.setFontSize(10);
              doc.setFont(undefined, "normal");
              doc.text(`Category: ${project.category || "General"}`, 20, y);
              doc.text(`Project Status: Completed`, 110, y);
              y += lineHeight;
              doc.text(
                `Generated: ${new Date().toLocaleDateString("en-US", {
                  year: "numeric",
                  month: "long",
                  day: "numeric",
                })}`,
                20,
                y,
              );
              y += lineHeight + 3;

              // Description
              doc.setFontSize(12);
              doc.setFont(undefined, "bold");
              doc.text("Project Description", 20, y);
              y += lineHeight;
              doc.setFontSize(10);
              doc.setFont(undefined, "normal");
              const descLines = doc.splitTextToSize(project.description, 170);
              doc.text(descLines, 20, y);
              y += descLines.length * lineHeight + 3;

              // Add more sections similar to exportProject function...
              // (Simplified for bulk generation)

              doc.text(`Period: ${project.period}`, 20, y);
              y += lineHeight;
              doc.text(
                `Budget: ₱${project.budget.toLocaleString()} (Spent: ₱${project.spent.toLocaleString()})`,
                20,
                y,
              );
              y += lineHeight;
              doc.text(`Volunteers: ${project.volunteers}`, 20, y);
              y += lineHeight;
              doc.text(`Success Rate: ${project.successRate}%`, 20, y);

              // Save PDF
              doc.save(
                `${project.name.replace(/[^a-zA-Z0-9]/g, "_")}_Report_${
                  i + 1
                }.pdf`,
              );

              // Small delay between downloads
              await new Promise((resolve) => setTimeout(resolve, 500));
            }

            showToast(
              `${selectedProjectsList.length} report(s) downloaded successfully!`,
              "success",
            );
            deselectAll();
          },
        );
      }

      // Initialize quarter summary
      updateQuarterSummary();

      // Update current date
      function updateCurrentDate() {
        const options = {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
        };
        const currentDate = new Date().toLocaleDateString("en-US", options);
        const dateElement = document.getElementById("currentDate");
        if (dateElement) {
          dateElement.textContent = currentDate;
        }
      }
      updateCurrentDate();

      // User profile data (in production, this would be fetched from server)
      let userProfile = {
        firstName: "Andrea",
        middleName: "",
        lastName: "Pelias",
        email: "andrea.pelias@malanday.gov.ph",
        position: "SK Chairman",
        address: "",
        contact: "",
        gender: "",
        birthday: "",
      };

      // Profile Modal Functions
      function openProfileModal() {
        // Load profile data into form
        document.getElementById("profileFirstName").value =
          userProfile.firstName;
        document.getElementById("profileMiddleName").value =
          userProfile.middleName;
        document.getElementById("profileLastName").value = userProfile.lastName;
        document.getElementById("profileEmail").value = userProfile.email;
        document.getElementById("profilePosition").value = userProfile.position;
        document.getElementById("profileAddress").value = userProfile.address;
        document.getElementById("profileContact").value = userProfile.contact;
        document.getElementById("profileGender").value = userProfile.gender;
        document.getElementById("profileBirthday").value = userProfile.birthday;

        // Load profile picture preview
        const previewDiv = document.getElementById("profilePicturePreview");
        if (userProfile.profilePicture) {
          previewDiv.innerHTML = `<img src="${userProfile.profilePicture}" alt="Profile Picture" class="w-full h-full object-cover rounded-full" />`;
        } else {
          const firstInitial = userProfile.firstName.charAt(0).toUpperCase();
          const lastInitial = userProfile.lastName.charAt(0).toUpperCase();
          previewDiv.innerHTML = `<span id="profileInitials" class="text-white font-bold text-2xl">${firstInitial}${lastInitial}</span>`;
        }

        document.getElementById("profileModal").classList.remove("hidden");
      }

      function closeProfileModal() {
        document.getElementById("profileModal").classList.add("hidden");
      }

      function handleProfilePictureChange(event) {
        const file = event.target.files[0];
        if (!file) return;

        // Validate file type
        if (!file.type.startsWith("image/")) {
          showToast("Please upload an image file", "error");
          return;
        }

        // Validate file size (max 5MB)
        if (file.size > 5 * 1024 * 1024) {
          showToast("Image size should be less than 5MB", "error");
          return;
        }

        const reader = new FileReader();
        reader.onload = function (e) {
          const imageData = e.target.result;

          // Store in profile
          userProfile.profilePicture = imageData;

          // Update modal preview
          const previewDiv = document.getElementById("profilePicturePreview");
          previewDiv.innerHTML = `<img src="${imageData}" alt="Profile Picture" class="w-full h-full object-cover rounded-full" />`;

          // Update header avatar
          updateHeaderAvatar();

          showToast("Profile picture uploaded successfully!");
        };
        reader.readAsDataURL(file);
      }

      function updateHeaderAvatar() {
        const headerAvatar = document.querySelector(
          "header .w-10.h-10.bg-[#2f6e4e]",
        );
        if (!headerAvatar) return;

        if (userProfile.profilePicture) {
          headerAvatar.innerHTML = `<img src="${userProfile.profilePicture}" alt="Profile" class="w-full h-full object-cover rounded-full" />`;
        } else {
          const firstInitial = userProfile.firstName.charAt(0).toUpperCase();
          const lastInitial = userProfile.lastName.charAt(0).toUpperCase();
          headerAvatar.innerHTML = `<span class="text-white font-bold">${firstInitial}${lastInitial}</span>`;
        }
      }

      function saveProfile() {
        // Get form values
        userProfile.firstName =
          document.getElementById("profileFirstName").value;
        userProfile.middleName =
          document.getElementById("profileMiddleName").value;
        userProfile.lastName = document.getElementById("profileLastName").value;
        userProfile.address = document.getElementById("profileAddress").value;
        userProfile.contact = document.getElementById("profileContact").value;
        userProfile.gender = document.getElementById("profileGender").value;
        userProfile.birthday = document.getElementById("profileBirthday").value;

        // Validation
        if (!userProfile.firstName || !userProfile.lastName) {
          showToast("First name and last name are required", "warning");
          return;
        }

        // In production, this would save to the server
        console.log("Profile saved:", userProfile);

        // Update header display
        const middleInitial = userProfile.middleName
          ? ` ${userProfile.middleName.charAt(0)}.`
          : "";
        const fullName = `${userProfile.firstName}${middleInitial} ${userProfile.lastName}`;
        document.querySelector("header .text-sm.font-medium").textContent =
          fullName;

        // Update header avatar
        updateHeaderAvatar();

        showToast("Profile updated successfully!");
        closeProfileModal();
      }

      // ===========================
      // ARCHIVED FILES FUNCTIONALITY
      // ===========================

      let archivedFiles = [];
      let currentArchiveType = "projects";

      // Helper: escape HTML to prevent XSS
      function escapeHTML(str) {
        if (!str) return '';
        const div = document.createElement('div');
        div.textContent = str;
        return div.innerHTML;
      }

      // Helper: sanitize file URL (only allow Supabase storage URLs)
      function sanitizeFileURL(url) {
        if (!url) return null;
        try {
          const parsed = new URL(url);
          const allowedHosts = ['supabase.co', 'supabase.com'];
          if (allowedHosts.some(host => parsed.hostname.endsWith(host))) {
            return url;
          }
        } catch (e) {
          console.warn('Invalid URL:', url);
        }
        return null;
      }

      // Helper: format date
      function formatFileDate(dateStr) {
        if (!dateStr) return 'N/A';
        try {
          const d = new Date(dateStr);
          return d.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
        } catch (e) {
          return dateStr;
        }
      }

      // Load archived files from Supabase File_Tbl
      async function loadArchivedFiles() {
        try {
          const { data, error } = await supabaseClient
            .from('File_Tbl')
            .select('*')
            .eq('fileStatus', 'ARCHIVED')
            .order('dateUploaded', { ascending: false });

          if (error) {
            console.error('Error loading archived files:', error);
            showToast('Failed to load archived files.', 'error');
            archivedFiles = [];
          } else {
            archivedFiles = (data || []).map(file => ({
              id: file.fileID,
              name: file.fileName,
              type: file.fileType?.toLowerCase() || 'file',
              uploaded: formatFileDate(file.dateUploaded),
              uploadedDate: file.dateUploaded ? new Date(file.dateUploaded) : null,
              category: file.fileCategory?.toLowerCase() || 'general',
              url: file.filePath,
              archivedDate: formatFileDate(file.dateArchived || file.updated_at)
            }));
          }
        } catch (err) {
          console.error('Load archived files exception:', err);
          archivedFiles = [];
        }
        updateFilesCount();
        if (currentArchiveType === 'files') {
          renderArchivedFiles();
        }
      }

      // Update files count badge
      function updateFilesCount() {
        const filesCountEl = document.getElementById("filesCount");
        if (filesCountEl) {
          filesCountEl.textContent = archivedFiles.length;
        }
      }

      // Switch between archive types (projects/files)
      function switchArchiveType(type) {
        currentArchiveType = type;

        // Update tab styles
        const tabs = document.querySelectorAll(".archive-type-tab");
        tabs.forEach((tab) => {
          tab.classList.remove("active", "text-[#2f6e4e]", "border-[#2f6e4e]");
          tab.classList.add("text-gray-500", "border-transparent");
        });

        const activeTab = document.getElementById(type + "Tab");
        if (activeTab) {
          activeTab.classList.add(
            "active",
            "text-[#2f6e4e]",
            "border-[#2f6e4e]",
          );
          activeTab.classList.remove("text-gray-500", "border-transparent");

          // Update count badge color
          const countSpan = activeTab.querySelector("span");
          if (countSpan) {
            countSpan.classList.remove("bg-gray-100", "bg-[#2f6e4e]/20");
            countSpan.classList.add("bg-[#2f6e4e]/20");
          }
        }

        // Update other tab count badge colors
        tabs.forEach((tab) => {
          if (!tab.classList.contains("active")) {
            const countSpan = tab.querySelector("span");
            if (countSpan) {
              countSpan.classList.remove("bg-[#2f6e4e]/20");
              countSpan.classList.add("bg-gray-100");
            }
          }
        });

        // Show/hide appropriate content
        const projectsList = document.getElementById("projectsList");
        const filesList = document.getElementById("filesList");
        const emptyState = document.getElementById("emptyState");
        const emptyFilesState = document.getElementById("emptyFilesState");
        const quarterSummary =
          document.getElementById("quarterSummary").parentElement;

        // Show/hide appropriate filters
        const projectsFilters = document.getElementById("projectsFilters");
        const filesFilters = document.getElementById("filesFilters");
        const bulkReportsSection =
          document.getElementById("bulkReportsSection");

        if (type === "projects") {
          projectsList.classList.remove("hidden");
          filesList.classList.add("hidden");
          emptyFilesState.classList.add("hidden");
          quarterSummary.classList.remove("hidden");

          // Show project filters, hide file filters
          projectsFilters.classList.remove("hidden");
          filesFilters.classList.add("hidden");
          bulkReportsSection.classList.remove("hidden");

          renderProjects();
        } else {
          projectsList.classList.add("hidden");
          emptyState.classList.add("hidden");
          filesList.classList.remove("hidden");
          quarterSummary.classList.add("hidden");

          // Show file filters, hide project filters
          projectsFilters.classList.add("hidden");
          filesFilters.classList.remove("hidden");
          bulkReportsSection.classList.add("hidden");

          renderArchivedFiles();
        }
      }

      // Render archived files
      function renderArchivedFiles() {
        const filesListContainer = document.querySelector("#filesList > div");
        const emptyFilesState = document.getElementById("emptyFilesState");

        filesListContainer.innerHTML = "";

        if (archivedFiles.length === 0) {
          emptyFilesState.classList.remove("hidden");
          return;
        }

        // Apply filters
        const searchQuery = document
          .getElementById("fileSearchInput")
          .value.toLowerCase();
        const fileTypeFilter = document.getElementById("fileTypeFilter").value;
        const yearFilter = document.getElementById("fileYearFilter").value;

        const filteredFiles = archivedFiles.filter((file) => {
          const matchesSearch = file.name.toLowerCase().includes(searchQuery);
          const matchesType =
            fileTypeFilter === "all" || file.type === fileTypeFilter;

          // Extract year for filtering
          let fileYear = "Unknown";
          if (file.uploadedDate) {
            const date = new Date(file.uploadedDate);
            fileYear = date.getFullYear().toString();
          } else if (file.uploaded) {
            const match = file.uploaded.match(/\d{4}/);
            if (match) {
              fileYear = match[0];
            }
          }
          const matchesYear = yearFilter === "all" || fileYear === yearFilter;

          return matchesSearch && matchesType && matchesYear;
        });

        if (filteredFiles.length === 0) {
          emptyFilesState.classList.remove("hidden");
          return;
        }

        emptyFilesState.classList.add("hidden");

        // Group files by year
        const filesByYear = {};
        filteredFiles.forEach((file) => {
          // Extract year from uploaded date
          let year = "Unknown";
          if (file.uploadedDate) {
            const date = new Date(file.uploadedDate);
            year = date.getFullYear();
          } else if (file.uploaded) {
            // Try to parse year from uploaded string (e.g., "Jan 20, 2023")
            const match = file.uploaded.match(/\d{4}/);
            if (match) {
              year = match[0];
            }
          }

          if (!filesByYear[year]) {
            filesByYear[year] = [];
          }
          filesByYear[year].push(file);
        });

        // Sort years in descending order
        const sortedYears = Object.keys(filesByYear).sort((a, b) => {
          if (a === "Unknown") return 1;
          if (b === "Unknown") return -1;
          return parseInt(b) - parseInt(a);
        });

        // Render files grouped by year
        sortedYears.forEach((year) => {
          // Create year header
          const yearHeader = document.createElement("div");
          yearHeader.className = "col-span-full mb-4 mt-6 first:mt-0";
          yearHeader.innerHTML = `
                    <div class="flex items-center">
                        <h3 class="text-xl font-bold text-gray-800">${year}</h3>
                        <span class="ml-3 px-3 py-1 bg-gray-100 text-gray-600 text-sm font-medium rounded-full">${
                          filesByYear[year].length
                        } file${
                          filesByYear[year].length !== 1 ? "s" : ""
                        }</span>
                    </div>
                    <div class="mt-2 h-px bg-gradient-to-r from-gray-300 to-transparent"></div>
                `;
          filesListContainer.appendChild(yearHeader);

          // Render files for this year
          filesByYear[year].forEach((file) => {
            const fileIconColor =
              {
                pdf: "bg-red-100 text-red-600",
                xlsx: "bg-[#2f6e4e]/20 text-[#2f6e4e]",
                png: "bg-blue-100 text-blue-600",
                jpg: "bg-blue-100 text-blue-600",
                default: "bg-gray-100 text-gray-700",
              }[file.type] || "bg-gray-100 text-gray-700";

            const card = document.createElement("div");
            card.className =
              "bg-white border border-gray-200 rounded-xl p-5 hover:shadow-lg transition";

            card.innerHTML = `
                        <div class="flex items-center mb-3">
                            <div class="w-10 h-10 ${fileIconColor} rounded-lg flex items-center justify-center font-bold">
                                ${file.type ? escapeHTML(file.type.toUpperCase()) : "FILE"}
                            </div>
                            <div class="ml-3 flex-1">
                                <p class="font-semibold text-gray-800">${escapeHTML(file.name)}</p>
                                <p class="text-xs text-gray-500">Uploaded: ${escapeHTML(file.uploaded)}</p>
                                <p class="text-xs text-gray-400">Archived: ${escapeHTML(file.archivedDate || "N/A")}</p>
                            </div>
                        </div>
                        <div class="flex justify-between mt-4 gap-2">
                            <button class="px-3 py-2 text-blue-600 hover:bg-blue-50 rounded-lg transition text-sm" onclick="viewArchivedFile(${file.id})">View</button>
                            <button class="px-3 py-2 text-[#2f6e4e] hover:bg-[#2f6e4e]/10 rounded-lg transition text-sm" onclick="restoreFile(${file.id})">Restore</button>
                            <button class="px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition text-sm" onclick="deleteArchivedFile(${file.id})">Delete</button>
                        </div>
                    `;

            filesListContainer.appendChild(card);
          });
        });
      }

      // View archived file with preview modal
      function viewArchivedFile(id) {
        const fileId = typeof id === 'string' ? parseInt(id, 10) : id;
        const file = archivedFiles.find((f) => f.id === fileId);
        if (!file) return;

        // Set modal content
        document.getElementById("viewArchivedFileTitle").textContent = escapeHTML(file.name);
        document.getElementById("viewArchivedFileName").textContent = escapeHTML(file.name);
        document.getElementById("viewArchivedFileDate").textContent = escapeHTML(file.uploaded);

        // Reset preview elements
        const img = document.getElementById("viewArchivedFileImg");
        const pdfCanvas = document.getElementById("archivedPdfCanvas");
        const fileIcon = document.getElementById("viewArchivedFileIcon");
        const viewLoading = document.getElementById("viewArchivedFileLoading");
        const viewPreview = document.getElementById("viewArchivedFilePreview");

        img.classList.add("hidden");
        pdfCanvas.classList.add("hidden");
        fileIcon.classList.add("hidden");
        viewLoading.classList.remove("hidden");
        viewPreview.classList.add("hidden");

        // Set download link
        const sanitizedUrl = sanitizeFileURL(file.url);
        const dl = document.getElementById("viewArchivedFileDownload");
        dl.href = sanitizedUrl || "#";
        dl.style.pointerEvents = sanitizedUrl ? 'auto' : 'none';
        dl.style.opacity = sanitizedUrl ? '1' : '0.5';

        // Show modal
        document.getElementById("viewArchivedFileModal").classList.remove("hidden");

        // Handle preview based on file type
        const fileType = file.type?.toLowerCase();

        try {
          if (['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(fileType) && sanitizedUrl) {
            img.src = sanitizedUrl;
            img.onload = () => {
              viewLoading.classList.add("hidden");
              viewPreview.classList.remove("hidden");
              img.classList.remove("hidden");
            };
            img.onerror = () => {
              showArchivedFileIconFallback(fileType);
            };
          } else if (fileType === 'pdf' && sanitizedUrl) {
            renderArchivedPdfPreview(sanitizedUrl);
          } else {
            showArchivedFileIconFallback(fileType);
          }
        } catch (e) {
          showArchivedFileIconFallback(fileType);
        }
      }

      function showArchivedFileIconFallback(fileType) {
        document.getElementById("viewArchivedFileLoading").classList.add("hidden");
        document.getElementById("viewArchivedFilePreview").classList.add("hidden");
        const iconContainer = document.getElementById("viewArchivedFileIcon");
        const iconBg = document.getElementById("viewArchivedFileIconBg");
        const typeLabel = document.getElementById("viewArchivedFileTypeLabel");
        iconContainer.classList.remove("hidden");
        const iconColors = {
          pdf: 'bg-red-100 text-red-600',
          xlsx: 'bg-green-100 text-green-600',
          xls: 'bg-green-100 text-green-600',
          doc: 'bg-blue-100 text-blue-600',
          docx: 'bg-blue-100 text-blue-600',
          png: 'bg-purple-100 text-purple-600',
          jpg: 'bg-purple-100 text-purple-600',
          jpeg: 'bg-purple-100 text-purple-600',
        };
        iconBg.className = `w-20 h-20 rounded-xl flex items-center justify-center mx-auto mb-3 ${iconColors[fileType] || 'bg-gray-100 text-gray-600'}`;
        typeLabel.textContent = (fileType || 'FILE').toUpperCase();
      }

      async function renderArchivedPdfPreview(url) {
        try {
          pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
          const pdf = await pdfjsLib.getDocument(url).promise;
          const page = await pdf.getPage(1);
          const scale = 1.2;
          const viewport = page.getViewport({ scale });
          const canvas = document.getElementById("archivedPdfCanvas");
          const context = canvas.getContext('2d');
          canvas.height = viewport.height;
          canvas.width = viewport.width;
          await page.render({ canvasContext: context, viewport }).promise;
          document.getElementById("viewArchivedFileLoading").classList.add("hidden");
          document.getElementById("viewArchivedFilePreview").classList.remove("hidden");
          canvas.classList.remove("hidden");
        } catch (e) {
          console.error('PDF preview error:', e);
          showArchivedFileIconFallback('pdf');
        }
      }

      function closeViewArchivedFileModal() {
        document.getElementById("viewArchivedFileModal").classList.add("hidden");
      }

      // Restore archived file (update database)
      let pendingRestoreFileId = null;
      let isRestoringFile = false;

      function restoreFile(id) {
        const fileId = typeof id === 'string' ? parseInt(id, 10) : id;
        const file = archivedFiles.find((f) => f.id === fileId);
        if (!file) return;

        pendingRestoreFileId = fileId;
        document.getElementById("restoreFileName").textContent = escapeHTML(file.name);
        document.getElementById("restoreFileModal").classList.remove("hidden");
      }

      function closeRestoreFileModal() {
        document.getElementById("restoreFileModal").classList.add("hidden");
        pendingRestoreFileId = null;
      }

      async function confirmRestoreFile() {
        if (!pendingRestoreFileId || isRestoringFile) return;

        isRestoringFile = true;
        try {
          // Update file status back to ACTIVE in database
          const { error } = await supabaseClient
            .from('File_Tbl')
            .update({ fileStatus: 'ACTIVE' })
            .eq('fileID', pendingRestoreFileId);

          if (error) {
            throw new Error(error.message);
          }

          showToast("File restored successfully!", "success");
          closeRestoreFileModal();
          await loadArchivedFiles();
        } catch (error) {
          console.error('Restore error:', error);
          showToast("Failed to restore file. Please try again.", "error");
        } finally {
          isRestoringFile = false;
        }
      }

      // Delete archived file permanently (from storage + database)
      let pendingDeleteFileId = null;
      let isDeletingFile = false;

      function deleteArchivedFile(id) {
        const fileId = typeof id === 'string' ? parseInt(id, 10) : id;
        const file = archivedFiles.find((f) => f.id === fileId);
        if (!file) return;

        pendingDeleteFileId = fileId;
        document.getElementById("deleteArchivedFileName").textContent =
          escapeHTML(file.name);
        document
          .getElementById("deleteArchivedFileModal")
          .classList.remove("hidden");
      }

      function closeDeleteArchivedFileModal() {
        document
          .getElementById("deleteArchivedFileModal")
          .classList.add("hidden");
        pendingDeleteFileId = null;
      }

      async function confirmDeleteArchivedFile() {
        if (!pendingDeleteFileId || isDeletingFile) return;

        isDeletingFile = true;
        try {
          const file = archivedFiles.find((f) => f.id === pendingDeleteFileId);

          // 1. Delete from storage (extract bucket and path from URL)
          if (file && file.url) {
            const urlMatch = file.url.match(/\/storage\/v1\/object\/public\/([^/]+)\/(.+)$/);
            if (urlMatch) {
              const bucketName = urlMatch[1];
              const filePath = urlMatch[2];
              await supabaseClient.storage.from(bucketName).remove([filePath]);
            }
          }

          // 2. Delete from database
          const { error } = await supabaseClient
            .from('File_Tbl')
            .delete()
            .eq('fileID', pendingDeleteFileId);

          if (error) {
            throw new Error(error.message);
          }

          showToast("File deleted permanently", "success");
          closeDeleteArchivedFileModal();
          await loadArchivedFiles();
        } catch (error) {
          console.error('Delete error:', error);
          showToast("Failed to delete file. Please try again.", "error");
        } finally {
          isDeletingFile = false;
        }
      }

      // Initialize archived files on page load
      document.addEventListener("DOMContentLoaded", function () {
        loadArchivedFiles();
      });

      // Notification System
      let notifications = [
        {
          id: 1,
          type: "project_approved",
          title: "Project Approved: Community Clean-Up Drive 2025",
          message:
            "Your project has been approved by the Barangay Captain and is now Ongoing",
          time: "2 hours ago",
          read: false,
          projectId: 1,
          status: "approved",
        },
        {
          id: 2,
          type: "project_rejected",
          title: "Project Rejected: International Youth Exchange Program",
          message:
            "Your project has been rejected. Click to view captain's feedback and edit your proposal",
          time: "1 day ago",
          read: false,
          projectId: 4,
          status: "rejected",
        },
        {
          id: 3,
          type: "project_revision",
          title: "Revision Requested: Scholarship Program Deadline",
          message:
            "The Barangay Captain requested revisions. Click to view feedback and edit your project",
          time: "3 hours ago",
          read: false,
          projectId: 3,
          status: "revision",
        },
        {
          id: 4,
          type: "new_inquiry",
          title: "New Inquiry: Community Clean-Up Drive 2025",
          message: "Juan Dela Cruz posted a new inquiry on your project",
          time: "5 minutes ago",
          read: false,
          projectId: 1,
        },
        {
          id: 5,
          type: "inquiry_reply",
          title: "Inquiry Reply: Youth Sports Festival",
          message: "Maria Santos replied to an inquiry thread",
          time: "1 hour ago",
          read: false,
          projectId: 2,
        },
        {
          id: 6,
          type: "new_announcement",
          title: "New Announcement Posted",
          message: "Kyleen Nicdao posted a new announcement",
          time: "2 hours ago",
          read: false,
          referenceId: 1,
        },
        {
          id: 7,
          type: "new_project",
          title: "New Project: Beach Clean-Up Initiative",
          message: "Andrea Pelias created a new project",
          time: "3 hours ago",
          read: false,
          referenceId: 3,
        },
        {
          id: 8,
          type: "project_application",
          title: "New Application: Community Clean-Up Drive 2025",
          message: "Juan Dela Cruz applied to your project",
          time: "30 minutes ago",
          read: false,
          projectId: 1,
          applicantId: 1,
        },
      ];

      function toggleNotificationModal() {
        const modal = document.getElementById("notificationModal");
        modal.classList.toggle("hidden");
        if (!modal.classList.contains("hidden")) {
          renderNotifications();
        }
      }

      function closeNotificationModal() {
        document.getElementById("notificationModal").classList.add("hidden");
      }

      function updateNotificationCount() {
        const unreadCount = notifications.filter((n) => !n.read).length;
        const badge = document.getElementById("notificationBadge");

        if (unreadCount > 0) {
          badge.textContent = unreadCount > 9 ? "9+" : unreadCount;
          badge.classList.remove("hidden");
        } else {
          badge.classList.add("hidden");
        }
      }

      function getNotificationIcon(type) {
        switch (type) {
          case "new_inquiry":
            return `<svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>`;
          case "inquiry_reply":
            return `<svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
              </svg>`;
          case "new_announcement":
            return `<svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"></path>
              </svg>`;
          case "new_project":
            return `<svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
              </svg>`;
          case "project_application":
            return `<svg class="w-6 h-6 text-[#2f6e4e]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>`;
          default:
            return "";
        }
      }

      function getNotificationBgColor(type) {
        switch (type) {
          case "new_inquiry":
            return "bg-yellow-50";
          case "inquiry_reply":
            return "bg-yellow-50";
          case "new_announcement":
            return "bg-blue-50";
          case "new_project":
            return "bg-blue-50";
          case "project_application":
            return "bg-[#2f6e4e]/10";
          default:
            return "bg-gray-50";
        }
      }

      function renderNotifications() {
        const notificationList = document.getElementById("notificationList");

        if (notifications.length === 0) {
          notificationList.innerHTML = `
              <div class="p-8 text-center text-gray-500">
                <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                </svg>
                <p class="font-medium">No notifications</p>
                <p class="text-sm mt-1">You're all caught up!</p>
              </div>
            `;
          return;
        }

        notificationList.innerHTML = notifications
          .map(
            (notif) => `
            <div
              onclick="handleNotificationClick(${notif.id})"
              class="p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition ${
                !notif.read ? getNotificationBgColor(notif.type) : ""
              }"
            >
              <div class="flex items-start space-x-3">
                <div class="flex-shrink-0">
                  ${getNotificationIcon(notif.type)}
                </div>
                <div class="flex-1 min-w-0">
                  <div class="flex items-start justify-between">
                    <p class="text-sm font-semibold text-gray-800 truncate ${
                      !notif.read ? "font-bold" : ""
                    }">
                      ${notif.title}
                    </p>
                    ${
                      !notif.read
                        ? '<span class="w-2 h-2 bg-[#2f6e4e] rounded-full flex-shrink-0 ml-2 mt-1"></span>'
                        : ""
                    }
                  </div>
                  <p class="text-xs text-gray-600 mt-1">${notif.message}</p>
                  <p class="text-xs text-gray-400 mt-2">${notif.time}</p>
                </div>
              </div>
            </div>
          `,
          )
          .join("");
      }

      function handleNotificationClick(notifId) {
        const notif = notifications.find((n) => n.id === notifId);
        if (!notif) return;

        notif.read = true;
        updateNotificationCount();
        closeNotificationModal();

        // Route to appropriate page based on notification type
        if (notif.type === "new_inquiry" || notif.type === "inquiry_reply") {
          window.location.href = `sk-projects.html?projectId=${notif.projectId}&tab=inquiries`;
        } else if (notif.type === "new_announcement") {
          window.location.href = `sk-dashboard.html`;
        } else if (notif.type === "new_project") {
          window.location.href = `sk-projects.html?projectId=${notif.referenceId}`;
        } else if (notif.type === "project_application") {
          window.location.href = `sk-projects.html?projectId=${notif.projectId}&tab=applications&applicantId=${notif.applicantId}`;
        }
      }

      function markAllAsRead() {
        notifications.forEach((n) => (n.read = true));
        updateNotificationCount();
        renderNotifications();
      }

      // Close notification modal when clicking outside
      document.addEventListener("click", function (event) {
        const modal = document.getElementById("notificationModal");
        const notificationButton = event.target.closest(
          'button[onclick="toggleNotificationModal()"]',
        );

        if (
          !modal.contains(event.target) &&
          !notificationButton &&
          !modal.classList.contains("hidden")
        ) {
          closeNotificationModal();
        }
      });

      // Initialize notification count on page load
      updateNotificationCount();
    </script>

    <!-- Profile Modal -->
    <div
      id="profileModal"
      class="hidden fixed inset-0 z-50 overflow-y-auto bg-black bg-opacity-50"
    >
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="relative bg-white rounded-2xl shadow-2xl max-w-2xl w-full">
          <!-- Header -->
          <div
            class="bg-gradient-to-r from-[#3d8b64] to-[#3d8b64] text-white p-6 rounded-t-2xl"
          >
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-4">
                <div
                  class="w-16 h-16 bg-white/20 backdrop-blur rounded-full flex items-center justify-center text-white font-bold text-2xl"
                >
                  AP
                </div>
                <div>
                  <h2 class="text-2xl font-bold">My Profile</h2>
                  <p class="text-[#2f6e4e]/20 text-sm">
                    Manage your account information
                  </p>
                </div>
              </div>
              <button
                onclick="closeProfileModal()"
                class="text-white hover:bg-white/20 rounded-lg p-2 transition"
              >
                <svg
                  class="w-6 h-6"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"
                  ></path>
                </svg>
              </button>
            </div>
          </div>

          <!-- Body -->
          <div class="p-6 space-y-6">
            <!-- Account Info Section -->
            <div>
              <h3
                class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2"
              >
                <svg
                  class="w-5 h-5 text-[#2f6e4e]"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                  ></path>
                </svg>
                Account Information
              </h3>
              <div class="grid grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2"
                    >First Name</label
                  >
                  <input
                    type="text"
                    id="profileFirstName"
                    value="Andrea"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#3d8b64] focus:border-transparent"
                  />
                </div>
                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2"
                    >Middle Name</label
                  >
                  <input
                    type="text"
                    id="profileMiddleName"
                    placeholder="Optional"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#3d8b64] focus:border-transparent"
                  />
                </div>
                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2"
                    >Last Name</label
                  >
                  <input
                    type="text"
                    id="profileLastName"
                    value="Pelias"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#3d8b64] focus:border-transparent"
                  />
                </div>
              </div>

              <div class="mt-4">
                <label class="block text-sm font-semibold text-gray-700 mb-2"
                  >Email Address</label
                >
                <input
                  type="email"
                  id="profileEmail"
                  value="andrea.pelias@malanday.gov.ph"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 cursor-not-allowed"
                  readonly
                />
                <p class="text-xs text-gray-500 mt-1">
                  Email cannot be changed. Contact admin if needed.
                </p>
              </div>

              <div class="mt-4">
                <label class="block text-sm font-semibold text-gray-700 mb-2"
                  >Position</label
                >
                <input
                  type="text"
                  id="profilePosition"
                  value="SK Chairman"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 cursor-not-allowed"
                  readonly
                />
              </div>
            </div>

            <!-- Personal Info Section -->
            <div class="pt-6 border-t border-gray-200">
              <h3
                class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2"
              >
                <svg
                  class="w-5 h-5 text-[#2f6e4e]"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
                  ></path>
                </svg>
                Personal Information
              </h3>

              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2"
                    >Complete Address</label
                  >
                  <textarea
                    id="profileAddress"
                    rows="3"
                    placeholder="Enter your complete address"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#3d8b64] focus:border-transparent"
                  ></textarea>
                </div>

                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2"
                    >Contact Number</label
                  >
                  <input
                    type="tel"
                    id="profileContact"
                    placeholder="e.g., 09171234567"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#3d8b64] focus:border-transparent"
                  />
                </div>

                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2"
                    >Gender</label
                  >
                  <select
                    id="profileGender"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#3d8b64] focus:border-transparent"
                  >
                    <option value="">Select gender</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="non-binary">
                      Non-binary / Gender Neutral
                    </option>
                    <option value="prefer-not-to-say">Prefer not to say</option>
                  </select>
                </div>

                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2"
                    >Birthday</label
                  >
                  <input
                    type="date"
                    id="profileBirthday"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#3d8b64] focus:border-transparent"
                  />
                </div>
              </div>
            </div>
          </div>

          <!-- Footer -->
          <div
            class="sticky bottom-0 bg-gray-50 px-6 py-4 rounded-b-2xl flex justify-end gap-3 border-t"
          >
            <button
              onclick="closeProfileModal()"
              class="px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg font-medium transition"
            >
              Cancel
            </button>
            <button
              onclick="saveProfile()"
              class="px-6 py-3 bg-[#2f6e4e] hover:bg-[#2f6e4e] text-white rounded-lg font-medium transition flex items-center gap-2"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M5 13l4 4L19 7"
                ></path>
              </svg>
              Save Changes
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Notification Modal -->
    <div
      id="notificationModal"
      class="hidden fixed top-20 right-6 w-96 bg-white rounded-xl shadow-2xl z-50 border border-gray-200"
    >
      <div
        class="p-4 border-b border-gray-200 flex items-center justify-between"
      >
        <h3 class="font-bold text-gray-800">Notifications</h3>
        <button
          onclick="markAllAsRead()"
          class="text-xs text-[#2f6e4e] hover:text-[#2f6e4e] font-medium"
        >
          Mark all as read
        </button>
      </div>
      <div id="notificationList" class="max-h-96 overflow-y-auto">
        <!-- Notifications will be dynamically inserted here -->
      </div>
    </div>
    <script src="js/mobile-nav.js"></script>
  </body>
</html>
