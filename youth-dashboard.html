<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>BIMS - Youth Volunteer Dashboard</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="css/responsive.css" />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#2f6e4e",
              secondary: "#3d8b64",
            },
            fontFamily: {
              sans: ["Inter", "system-ui", "sans-serif"],
            },
          },
        },
      };
    </script>
    <style>
      /* Enhanced Icon System */
      .icon-wrapper {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .icon-wrapper:hover {
        transform: translateY(-2px);
      }

      .nav-link svg {
        transition: all 0.3s ease;
      }

      .nav-link:hover svg {
        transform: scale(1.1);
      }

      .icon-badge {
        box-shadow: 0 2px 8px rgba(47, 110, 78, 0.15);
      }

      .notification-icon {
        position: relative;
      }

      .notification-icon:hover {
        transform: rotate(15deg) scale(1.1);
        transition: transform 0.3s ease;
      }

      /* Status Icons */
      .status-icon-pending {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      }

      .status-icon-approved {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      }

      .status-icon-rejected {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      }

      /* Icon Enhancement Classes */
      .icon-primary {
        filter: drop-shadow(0 2px 4px rgba(47, 110, 78, 0.1));
      }

      .icon-glow {
        filter: drop-shadow(0 0 8px rgba(47, 110, 78, 0.3));
      }

      /* Toast Notification Styles */
      .toast {
        position: fixed;
        top: 20px;
        right: 20px;
        min-width: 300px;
        background: white;
        padding: 16px 20px;
        border-radius: 12px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        display: flex;
        align-items: center;
        gap: 12px;
        transform: translateX(400px);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 9999;
      }

      .toast.show {
        transform: translateX(0);
      }

      .toast.success {
        border-left: 4px solid #10b981;
      }

      .toast.error {
        border-left: 4px solid #ef4444;
      }

      .toast.warning {
        border-left: 4px solid #f59e0b;
      }

      .toast.info {
        border-left: 4px solid #3b82f6;
      }

      /* Input validation states */
      .input-error {
        border-color: #ef4444 !important;
        background-color: #fef2f2 !important;
      }

      .input-success {
        border-color: #10b981 !important;
      }

      /* Loading spinner */
      .spinner {
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        width: 16px;
        height: 16px;
        animation: spin 0.6s linear infinite;
      }

      @keyframes spin {
        to { transform: rotate(360deg); }
      }

      /* Character counter */
      .char-counter {
        font-size: 0.75rem;
        color: #6b7280;
        text-align: right;
        margin-top: 0.25rem;
      }

      .char-counter.warning {
        color: #f59e0b;
      }

      .char-counter.error {
        color: #ef4444;
      }

      /* Pagination dots - consistent across all screen sizes */
      #announcementPaginationDots button {
        flex-shrink: 0;
        display: inline-block;
        cursor: pointer;
        border: none;
        padding: 0;
        outline: none;
      }

      #announcementPaginationDots button:focus {
        outline: 2px solid rgba(47, 110, 78, 0.3);
        outline-offset: 2px;
      }

      /* Limit announcement description to 5 lines with ellipsis */
      .announcement-description {
        display: -webkit-box;
        -webkit-line-clamp: 5;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
        line-height: 1.5;
        height: calc(1.5em * 5); /* Fixed height for 5 lines - keeps cards consistent */
        min-height: calc(1.5em * 5); /* Ensure minimum height even with short text */
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <div class="flex h-screen overflow-hidden">
      <!-- Sidebar -->
      <aside
        class="w-64 bg-white shadow-lg flex-shrink-0 h-screen flex flex-col"
      >
        <div class="p-6 flex-1 flex flex-col">
          <!-- Logo -->
          <div class="flex items-center space-x-4 mb-8">
            <div
              class="w-12 h-12 bg-white rounded-xl flex items-center justify-center shadow-lg icon-badge overflow-hidden"
            >
              <img src="asset/logo.svg" alt="BIMS Logo" class="w-full h-full object-contain p-1">
            </div>
            <div>
              <h1 class="text-xl font-black text-gray-800">BIMS</h1>
              <p class="text-sm text-gray-600 font-medium">SK Malanday</p>
            </div>
          </div>

          <!-- Menu -->
          <nav class="space-y-2">
            <a
              href="youth-dashboard.html"
              class="nav-link flex items-center space-x-3 px-4 py-3 bg-[#2f6e4e]/10 text-[#2f6e4e] rounded-lg font-medium group w-full"
            >
              <div class="w-9 h-9 bg-[#2f6e4e]/20 rounded-lg flex items-center justify-center group-hover:bg-[#2f6e4e]/30 transition">
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  stroke-width="2.5"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3"
                  ></path>
                </svg>
              </div>
              <span>Dashboard</span>
            </a>

            <a
              href="youth-files.html"
              class="nav-link flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-[#2f6e4e]/10 hover:text-[#2f6e4e] rounded-lg font-medium group transition w-full"
            >
              <div class="w-9 h-9 bg-gray-100 rounded-lg flex items-center justify-center group-hover:bg-[#2f6e4e]/20 transition">
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                  ></path>
                </svg>
              </div>
              <span>Files</span>
            </a>

            <a
              href="youth-projects.html"
              class="nav-link flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-[#2f6e4e]/10 hover:text-[#2f6e4e] rounded-lg font-medium group transition w-full"
            >
              <div class="w-9 h-9 bg-gray-100 rounded-lg flex items-center justify-center group-hover:bg-[#2f6e4e]/20 transition">
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                  ></path>
                </svg>
              </div>
              <span>Projects</span>
            </a>

            <a
              href="youth-calendar.html"
              class="nav-link flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-[#2f6e4e]/10 hover:text-[#2f6e4e] rounded-lg font-medium group transition w-full"
            >
              <div class="w-9 h-9 bg-gray-100 rounded-lg flex items-center justify-center group-hover:bg-[#2f6e4e]/20 transition">
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                  ></path>
                </svg>
              </div>
              <span>Calendar</span>
            </a>

            <a
              href="youth-certificates.html"
              class="nav-link flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-[#2f6e4e]/10 hover:text-[#2f6e4e] rounded-lg font-medium group transition w-full"
            >
              <div class="w-9 h-9 bg-gray-100 rounded-lg flex items-center justify-center group-hover:bg-[#2f6e4e]/20 transition">
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"
                  ></path>
                </svg>
              </div>
              <span>Certificates</span>
            </a>
          </nav>

          <div class="flex-1"></div>

          <!-- Logout -->
          <div class="mt-8 pt-8 border-t border-gray-200">
            <button
              onclick="handleLogout()"
              class="nav-link flex items-center space-x-3 px-4 py-3 text-red-600 hover:bg-red-50 rounded-lg transition w-full group"
            >
              <div class="w-9 h-9 bg-red-50 rounded-lg flex items-center justify-center group-hover:bg-red-100 transition">
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
                  ></path>
                </svg>
              </div>
              <span class="font-medium">Logout</span>
            </button>
          </div>
        </div>
      </aside>

      <!-- Main -->
      <div class="flex-1 overflow-auto">
        <!-- Top bar -->
        <header class="bg-gradient-to-r from-[#2f6e4e]/10 to-white border-b border-gray-200">
          <div class="px-8 py-6">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-[#2f6e4e] font-semibold mb-1" id="currentDate">Sunday, December 14, 2025</p>
                <h1 class="text-2xl font-bold text-gray-800">Dashboard</h1>
                <p class="text-sm text-gray-600 mt-1">Your volunteer snapshot - view announcements</p>
              </div>
              <div class="flex items-center space-x-4">
                <div class="relative">
                  <button onclick="window.notificationModal.toggle()" class="notification-icon p-2.5 text-gray-600 hover:bg-[#2f6e4e]/10 hover:text-[#2f6e4e] rounded-xl transition-all duration-300" title="Notifications">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                    </svg>
                    <span id="notificationBadge" class="hidden absolute -top-1 -right-1 bg-gradient-to-br from-red-500 to-red-600 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center shadow-lg shadow-red-500/50 animate-pulse">5</span>
                  </button>
                </div>
                <div class="flex items-center space-x-3 cursor-pointer hover:bg-gray-50 rounded-xl px-3 py-2 transition-all duration-300 group" onclick="window.profileModal.open()">
                  <div class="text-right">
                    <p class="text-sm font-medium text-gray-700 group-hover:text-[#2f6e4e] transition" id="headerUserName">Youth Volunteer</p>
                    <p class="text-xs text-gray-500">Volunteer</p>
                  </div>
                  <div class="w-10 h-10 bg-gradient-to-br from-[#2f6e4e] to-[#3d8b64] rounded-full flex items-center justify-center text-white font-semibold shadow-lg ring-2 ring-[#2f6e4e]/20 group-hover:ring-[#2f6e4e]/40 transition" id="headerAvatar">
                    YV
                  </div>
                </div>
              </div>
            </div>
          </div>
        </header>

        <!-- Content -->
        <main class="px-6 py-6">
          <div class="max-w-7xl mx-auto space-y-6">
            <!-- Announcements (read-only) -->
            <section class="bg-white rounded-xl shadow-sm p-6">
              <div class="mb-6">
                <h3 class="text-lg font-bold text-gray-800">Announcements</h3>
              </div>

              <div id="announcementsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- announcements will be inserted by JS -->
              </div>

              <!-- Pagination Dots (Center) -->
              <div id="announcementPaginationDots" class="flex justify-center gap-2 mt-6 hidden">
                <!-- Dots will be inserted here -->
              </div>

              <!-- Pagination Controls (Bottom Right) -->
              <div class="mt-6 flex justify-end">
                <nav
                  id="announcementPaginationNav"
                  class="hidden inline-flex rounded-md shadow-sm"
                  role="navigation"
                  aria-label="Pagination"
                >
                  <button
                    id="prevAnnouncementPage"
                    onclick="navigateAnnouncements(-1)"
                    class="px-3 py-2 border border-gray-200 rounded-l-md hover:bg-gray-50 transition text-gray-700 font-medium"
                  >
                    Prev
                  </button>
                  <button
                    id="nextAnnouncementPage"
                    onclick="navigateAnnouncements(1)"
                    class="px-3 py-2 border-t border-b border-r border-gray-200 rounded-r-md hover:bg-gray-50 transition text-gray-700 font-medium"
                  >
                    Next
                  </button>
                </nav>
              </div>

              <!-- Hidden template for backward compatibility -->
              <div class="hidden">
                <article
                  class="border border-gray-200 rounded-xl overflow-hidden hover:shadow-lg transition flex flex-col"
                >
                  <div
                    class="h-36 bg-gradient-to-br from-orange-400 to-orange-500 flex items-center justify-center"
                  >
                    <svg
                      class="w-20 h-20 text-white"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"
                      ></path>
                    </svg>
                  </div>

                  <div class="p-5 flex flex-col flex-1">
                    <div class="flex items-center justify-between mb-3">
                      <span
                        class="px-3 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full"
                        >urgent</span
                      >
                      <span class="text-xs text-gray-500">Nov 18, 2025</span>
                    </div>

                    <h4 class="text-lg font-bold text-gray-800 mb-2">
                      Youth Sports Festival 2025
                    </h4>
                    <p class="text-sm text-gray-600 mb-4">
                      Join us for basketball, volleyball, and more — open to
                      youth aged 15–30.
                    </p>

                    <div class="flex justify-end mt-auto">
                      <button
                        onclick="viewAnnouncement(1)"
                        class="px-4 py-2 bg-[#2f6e4e] hover:bg-[#2f6e4e] text-white rounded-lg text-sm font-medium transition"
                      >
                        View
                      </button>
                    </div>
                  </div>
                </article>

                <!-- Announcement 2 -->
                <article
                  class="border border-gray-200 rounded-xl overflow-hidden hover:shadow-lg transition flex flex-col"
                >
                  <div
                    class="h-36 bg-gradient-to-br from-blue-400 to-blue-500 flex items-center justify-center"
                  >
                    <svg
                      class="w-20 h-20 text-white"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253"
                      ></path>
                    </svg>
                  </div>

                  <div class="p-5 flex flex-col flex-1">
                    <div class="flex items-center justify-between mb-3">
                      <span
                        class="px-3 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded-full"
                        >general</span
                      >
                      <span class="text-xs text-gray-500">Nov 25, 2025</span>
                    </div>

                    <h4 class="text-lg font-bold text-gray-800 mb-2">
                      Free Skills Training Workshop
                    </h4>
                    <p class="text-sm text-gray-600 mb-4">
                      Digital marketing, design, and programming basics.
                    </p>

                    <div class="flex justify-end mt-auto">
                      <button
                        onclick="viewAnnouncement(2)"
                        class="px-4 py-2 bg-[#2f6e4e] hover:bg-[#2f6e4e] text-white rounded-lg text-sm font-medium transition"
                      >
                        View
                      </button>
                    </div>
                  </div>
                </article>

                <!-- Announcement 3 -->
                <article
                  class="border border-gray-200 rounded-xl overflow-hidden hover:shadow-lg transition flex flex-col"
                >
                  <div
                    class="h-36 bg-gradient-to-br from-green-400 to-green-500 flex items-center justify-center"
                  >
                    <svg
                      class="w-20 h-20 text-white"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                      ></path>
                    </svg>
                  </div>

                  <div class="p-5 flex flex-col flex-1">
                    <div class="flex items-center justify-between mb-3">
                      <span
                        class="px-3 py-1 bg-[#2f6e4e]/20 text-[#2f6e4e] text-xs font-medium rounded-full"
                        >update</span
                      >
                      <span class="text-xs text-gray-500">Nov 15, 2025</span>
                    </div>

                    <h4 class="text-lg font-bold text-gray-800 mb-2">
                      Scholarship Program Now Open
                    </h4>
                    <p class="text-sm text-gray-600 mb-4">
                      Apply now — deadline Dec 15, 2025.
                    </p>

                    <div class="flex justify-end mt-auto">
                      <button
                        onclick="viewAnnouncement(3)"
                        class="px-4 py-2 bg-[#2f6e4e] hover:bg-[#2f6e4e] text-white rounded-lg text-sm font-medium transition"
                      >
                        View
                      </button>
                    </div>
                  </div>
                </article>
              </div>
            </section>

            <!-- Submit Testimony Section -->
            <section class="bg-white rounded-xl shadow-sm p-6">
              <div class="mb-6">
                <h3 class="text-lg font-bold text-gray-800">Share Your Experience</h3>
                <p class="text-sm text-gray-600 mt-1">Tell us about your volunteer experience and help inspire others!</p>
              </div>

              <form id="testimonyForm" class="space-y-4">
                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2">Rate Your Experience *</label>
                  <div class="flex flex-col items-start gap-y-2 sm:flex-row sm:items-center sm:gap-y-0 sm:space-x-2">
                    <div id="starRating" class="flex space-x-1">
                      <svg data-star="1" class="w-8 h-8 sm:w-10 sm:h-10 cursor-pointer text-gray-300 hover:text-yellow-400 transition" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                      </svg>
                      <svg data-star="2" class="w-8 h-8 sm:w-10 sm:h-10 cursor-pointer text-gray-300 hover:text-yellow-400 transition" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                      </svg>
                      <svg data-star="3" class="w-8 h-8 sm:w-10 sm:h-10 cursor-pointer text-gray-300 hover:text-yellow-400 transition" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                      </svg>
                      <svg data-star="4" class="w-8 h-8 sm:w-10 sm:h-10 cursor-pointer text-gray-300 hover:text-yellow-400 transition" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                      </svg>
                      <svg data-star="5" class="w-8 h-8 sm:w-10 sm:h-10 cursor-pointer text-gray-300 hover:text-yellow-400 transition" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                      </svg>
                    </div>
                    <span id="ratingText" class="text-sm font-medium text-gray-600">No rating selected</span>
                  </div>
                  <input type="hidden" id="satisfactionScore" name="satisfactionScore" value="0" required>
                  <p class="text-xs text-gray-500 mt-1">Click the stars to rate your satisfaction (1-5 stars)</p>
                </div>

                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2">Your Testimony *</label>
                  <textarea
                    id="testimonyText"
                    rows="5"
                    maxlength="500"
                    required
                    placeholder="Share your experience, what you learned, and how the project impacted you..."
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#3d8b64] focus:border-transparent"
                    oninput="updateCharCount('testimonyText', 'testimonyCharCount', 500)"
                  ></textarea>
                  <div class="flex justify-between items-center">
                    <p class="text-xs text-gray-500 mt-1">Minimum 50 characters</p>
                    <div id="testimonyCharCount" class="char-counter">0/500 characters</div>
                  </div>
                </div>

                <div class="flex justify-end space-x-3">
                  <button
                    type="button"
                    onclick="resetTestimonyForm()"
                    class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition font-medium"
                  >
                    Clear
                  </button>
                  <button
                    type="submit"
                    class="px-6 py-3 bg-[#2f6e4e] hover:bg-[#2f6e4e] text-white rounded-lg transition font-medium"
                  >
                    Submit Testimony
                  </button>
                </div>
              </form>
            </section>
          </div>
        </main>
      </div>
    </div>

    <!-- Announcement View Modal (read-only) -->
    <div
      id="announcementModal"
      class="hidden fixed inset-0 bg-black bg-opacity-40 z-50 flex items-center justify-center p-4"
    >
      <div
        class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"
      >
        <div class="p-6 border-b border-gray-200">
          <div class="flex items-center justify-between mb-3">
            <p
              id="announceCategory"
              class="inline-block px-3 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full"
            >
              urgent
            </p>
            <button
              onclick="closeAnnouncementModal()"
              class="text-gray-400 hover:text-gray-600 transition"
            >
              ✕
            </button>
          </div>
          <h3 id="announceTitle" class="text-2xl font-bold text-gray-800">
            Announcement Title
          </h3>
        </div>

        <div class="p-6 space-y-4">
          <div
            id="announceImage"
            class="h-64 bg-gray-100 rounded-lg flex items-center justify-center overflow-hidden"
          >
            <!-- image inserted by JS -->
            <img
              id="announceImgTag"
              src="/mnt/data/Screenshot 2025-11-20 205421.png"
              alt="img"
              class="object-cover h-full w-full"
            />
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2"
              >Date Posted</label
            >
            <p id="announceDate" class="text-gray-600">Nov 18, 2025</p>
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2"
              >Description</label
            >
            <p id="announceDesc" class="text-gray-600">
              Full details will appear here...
            </p>
          </div>
        </div>

        <div class="p-6 border-t border-gray-200 flex justify-end">
          <button
            onclick="closeAnnouncementModal()"
            class="px-6 py-3 bg-[#2f6e4e] hover:bg-[#2f6e4e] text-white rounded-lg transition font-medium"
          >
            Close
          </button>
        </div>
      </div>
    </div>

    <!-- Notification Modal -->
    <!-- Notification Modal - Injected by NotificationModal.js component -->

    <!-- Application Details Drawer (right) -->
    <div
      id="appDrawer"
      class="fixed right-0 top-0 h-full w-96 bg-white shadow-xl z-50 transform translate-x-full transition-transform"
    >
      <div
        class="p-6 border-b border-gray-100 flex items-center justify-between"
      >
        <h3 id="appDrawerTitle" class="text-lg font-bold text-gray-800">
          Application Details
        </h3>
        <button
          onclick="closeAppDrawer()"
          class="text-gray-400 hover:text-gray-600"
        >
          ✕
        </button>
      </div>

      <div class="p-6 space-y-4">
        <p id="appProjectTitle" class="font-semibold text-gray-800">
          Project Name
        </p>
        <p class="text-sm text-gray-500" id="appAppliedDate">
          Applied: Nov 10, 2025
        </p>

        <div>
          <label class="text-sm font-semibold text-gray-700">Status</label>
          <div id="appStatus" class="mt-2">
            <!-- status badge -->
          </div>
        </div>

        <div>
          <label class="text-sm font-semibold text-gray-700">Role</label>
          <p id="appRole" class="text-gray-600 mt-1">Volunteer</p>
        </div>

        <div>
          <label class="text-sm font-semibold text-gray-700">Notes</label>
          <p id="appNotes" class="text-gray-600 mt-1">No notes.</p>
        </div>

        <div class="pt-4">
          <button
            onclick="closeAppDrawer()"
            class="px-4 py-2 bg-[#2f6e4e] text-white rounded-lg"
          >
            Close
          </button>
        </div>
      </div>
    </div>

    <!-- ProfileModal component will be dynamically rendered here -->

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config/env.js"></script>
    <script src="js/config/supabase.js"></script>
    <script src="js/auth/auth.js"></script>
    <script src="js/auth/session.js"></script>

    <script type="module">
      // Import components
      import { NotificationModal } from './js/components/NotificationModal.js';
      import { ProfileModal } from './js/components/ProfileModal.js';

      // ============================================
      // GLOBAL VARIABLES (properly declared)
      // ============================================
      let profileBackup = {};
      let isEditMode = false;

      // ============================================
      // DEBUG: Production-safe logging utility
      // Set DEBUG_MODE to false in production
      // ============================================
      const DEBUG_MODE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';

      const debug = {
        log: (...args) => DEBUG_MODE && console.log('[YOUTH-DASHBOARD]', ...args),
        warn: (...args) => DEBUG_MODE && console.warn('[YOUTH-DASHBOARD]', ...args),
        error: (...args) => console.error('[YOUTH-DASHBOARD]', ...args), // Always log errors
      };

      // ============================================
      // SECURITY: XSS Prevention Helpers
      // ============================================
      /**
       * Escape HTML to prevent XSS attacks
       * @param {string} unsafe - Unsafe string from user input or database
       * @returns {string} - Safe HTML string
       */
      function escapeHTML(unsafe) {
        if (typeof unsafe !== "string") return "";
        return unsafe
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
      }

      /**
       * SECURITY: Validate and sanitize image URLs
       * Only allows https URLs and Supabase storage URLs
       * @param {string} url - URL to validate
       * @returns {string} - Safe URL or empty string
       */
      function sanitizeImageURL(url) {
        if (!url || typeof url !== "string") return "";

        const trimmedUrl = url.trim();
        if (!trimmedUrl) return "";

        // Only allow https:// URLs (block javascript:, data:, etc.)
        if (!trimmedUrl.startsWith("https://")) {
          return "";
        }

        // Validate URL format
        try {
          new URL(trimmedUrl);
          return trimmedUrl;
        } catch (e) {
          return "";
        }
      }

      // Initialize NotificationModal component
      const notificationModal = new NotificationModal();
      notificationModal.render();

      // Initialize ProfileModal component
      const profileModal = new ProfileModal();
      profileModal.render();
      window.profileModal = profileModal;
      console.log('[YOUTH DASHBOARD] ProfileModal component initialized');

      // Load user data from Supabase on page load
      async function loadUserProfile() {
        try {
          console.log('[YOUTH DASHBOARD] Loading user profile...');

          // Use SessionManager for consistent authentication
          const sessionResult = await SessionManager.requireAuth(['YOUTH_VOLUNTEER']);

          if (!sessionResult.success) {
            console.error('[YOUTH DASHBOARD] Authentication failed:', sessionResult.error);
            return; // SessionManager handles redirect
          }

          console.log('[YOUTH DASHBOARD] Authentication successful!');

          const user = sessionResult.user;
          const userData = sessionResult.userData;

          // Load user data into ProfileModal component
          await profileModal.loadUserData(user, userData);

          // Update UI with loaded data
          updateProfileUI(user, userData);

          console.log('[YOUTH DASHBOARD] User profile loaded successfully');

        } catch (error) {
          console.error('Error loading user profile:', error);
          // Don't show toast - SessionManager already handles redirects
        }
      }

      // Update the profile UI with loaded data
      function updateProfileUI(user, userData) {
        // Update header profile display - name (excluding middle name for consistency)
        const fullName = `${userData.firstName || ''} ${userData.lastName || ''}`.trim();

        // Update header name using element ID
        const nameElement = document.getElementById('headerUserName');
        if (nameElement) {
          nameElement.textContent = fullName || 'Youth Volunteer';
        }

        // Update profile picture/initials if needed
        updateProfilePicture(userData);
      }

      // Update profile picture/initials in the UI
      function updateProfilePicture(userData) {
        console.log('[UPDATE PICTURE] Starting update, userData.imagePathURL:', userData.imagePathURL);

        const firstInitial = userData.firstName ? userData.firstName.charAt(0).toUpperCase() : 'Y';
        const lastInitial = userData.lastName ? userData.lastName.charAt(0).toUpperCase() : 'V';

        // Update header avatar using element ID
        const headerAvatarDiv = document.getElementById('headerAvatar');
        console.log('[UPDATE PICTURE] headerAvatar element found:', !!headerAvatarDiv);

        if (headerAvatarDiv) {
          // SECURITY: Sanitize profile picture URL
          const safeProfileUrl = sanitizeImageURL(userData.imagePathURL);
          if (safeProfileUrl) {
            // Show profile picture with sanitized URL
            headerAvatarDiv.innerHTML = `<img src="${safeProfileUrl}" alt="Profile" class="w-full h-full object-cover rounded-full" onerror="this.parentElement.innerHTML='<span class=\\'text-white font-semibold\\'>${escapeHTML(firstInitial)}${escapeHTML(lastInitial)}</span>';" />`;
          } else {
            // Show initials
            headerAvatarDiv.innerHTML = `<span class="text-white font-semibold">${escapeHTML(firstInitial)}${escapeHTML(lastInitial)}</span>`;
          }
        }
      }

      // Call loadUserProfile and loadAnnouncements when page loads
      window.addEventListener('DOMContentLoaded', async () => {
        await loadUserProfile();
        await loadAnnouncements();
      });

      // Listen for profile updates from ProfileModal
      window.addEventListener('profileUpdated', (event) => {
        const profile = event.detail;

        // Update local userProfile object
        userProfile.firstName = profile.firstName;
        userProfile.middleName = profile.middleName || '';
        userProfile.lastName = profile.lastName;
        userProfile.address = profile.address;
        userProfile.contact = profile.contact;
        userProfile.birthday = profile.birthday;
        userProfile.gender = profile.gender;
        if (profile.profilePicture) {
          userProfile.profilePicture = profile.profilePicture;
        }

        // Update header UI
        updateProfileUI();
      });

      // Profile functions - handled by ProfileModal component (window.profileModal)

      // Helper function to show field error state
      function showFieldError(fieldId, errorId, message) {
        const field = document.getElementById(fieldId);
        const error = document.getElementById(errorId);
        if (field) {
          field.classList.add('border-red-500');
          field.classList.remove('border-gray-300');
        }
        if (error) {
          error.textContent = message;
          error.classList.remove('hidden');
        }
      }

      // Helper function to clear field error state
      function clearFieldError(fieldId, errorId) {
        const field = document.getElementById(fieldId);
        const error = document.getElementById(errorId);
        if (field && error) {
          field.classList.remove('border-red-500');
          field.classList.add('border-gray-300');
          error.classList.add('hidden');
        }
      }

      function clearAllErrors() {
        const errorFields = ['firstNameError', 'middleNameError', 'lastNameError', 'contactError', 'addressError', 'genderError', 'birthdayError'];
        const inputFields = ['profileFirstName', 'profileMiddleName', 'profileLastName', 'profileContact', 'profileAddress', 'profileGender', 'profileBirthday'];

        errorFields.forEach((errorId, index) => {
          clearFieldError(inputFields[index], errorId);
        });
      }

      function validateField(fieldId, value, rules) {
        const { required, minLength, maxLength, pattern, customValidation, errorId, fieldName } = rules;

        if (required && (!value || value.trim() === '')) {
          showFieldError(fieldId, errorId, `${fieldName} is required`);
          return false;
        }

        if (value && minLength && value.trim().length < minLength) {
          showFieldError(fieldId, errorId, `${fieldName} must be at least ${minLength} characters`);
          return false;
        }

        if (value && maxLength && value.trim().length > maxLength) {
          showFieldError(fieldId, errorId, `${fieldName} must not exceed ${maxLength} characters`);
          return false;
        }

        if (value && pattern && !pattern.test(value)) {
          showFieldError(fieldId, errorId, rules.patternMessage || `${fieldName} format is invalid`);
          return false;
        }

        if (customValidation) {
          const customResult = customValidation(value);
          if (!customResult.valid) {
            showFieldError(fieldId, errorId, customResult.message);
            return false;
          }
        }

        clearFieldError(fieldId, errorId);
        return true;
      }

      function setProfileFieldsState(editable) {
        const editableFields = ['profileFirstName', 'profileMiddleName', 'profileLastName', 'profileContact', 'profileAddress', 'profileGender', 'profileBirthday'];

        editableFields.forEach(fieldId => {
          const field = document.getElementById(fieldId);
          if (field) {
            field.disabled = !editable;
            if (editable) {
              field.classList.remove('bg-gray-50', 'cursor-not-allowed');
              field.classList.add('bg-white');
            } else {
              field.classList.add('bg-gray-50', 'cursor-not-allowed');
              field.classList.remove('bg-white');
            }
          }
        });

        // Toggle profile picture upload button
        const uploadBtn = document.getElementById('profilePictureUploadBtn');
        if (uploadBtn) {
          if (editable) {
            uploadBtn.classList.remove('hidden');
          } else {
            uploadBtn.classList.add('hidden');
          }
        }

        // Toggle button visibility
        const viewButtons = document.getElementById('viewModeButtons');
        const editButtons = document.getElementById('editModeButtons');

        if (editable) {
          viewButtons.classList.add('hidden');
          editButtons.classList.remove('hidden');
        } else {
          viewButtons.classList.remove('hidden');
          editButtons.classList.add('hidden');
        }
      }

      function enterEditMode() {
        // Save current state for potential cancel
        profileBackup = {
          firstName: document.getElementById('profileFirstName').value,
          middleName: document.getElementById('profileMiddleName').value,
          lastName: document.getElementById('profileLastName').value,
          address: document.getElementById('profileAddress').value,
          contact: document.getElementById('profileContact').value,
          gender: document.getElementById('profileGender').value,
          birthday: document.getElementById('profileBirthday').value
        };

        isEditMode = true;
        setProfileFieldsState(true);
        clearAllErrors();
      }

      function cancelEdit() {
        // Restore backed up values
        document.getElementById('profileFirstName').value = profileBackup.firstName;
        document.getElementById('profileMiddleName').value = profileBackup.middleName;
        document.getElementById('profileLastName').value = profileBackup.lastName;
        document.getElementById('profileAddress').value = profileBackup.address;
        document.getElementById('profileContact').value = profileBackup.contact;
        document.getElementById('profileGender').value = profileBackup.gender;
        document.getElementById('profileBirthday').value = profileBackup.birthday;

        isEditMode = false;
        setProfileFieldsState(false);
        clearAllErrors();
      }

      // Profile Modal Functions
      function openProfileModal() {
        // Load profile data into form
        document.getElementById('profileFirstName').value = userProfile.firstName;
        document.getElementById('profileMiddleName').value = userProfile.middleName;
        document.getElementById('profileLastName').value = userProfile.lastName;
        document.getElementById('profileEmail').value = userProfile.email;
        document.getElementById('profilePosition').value = userProfile.position;
        document.getElementById('profileAddress').value = userProfile.address;
        document.getElementById('profileContact').value = userProfile.contact;
        document.getElementById('profileGender').value = userProfile.gender;
        document.getElementById('profileBirthday').value = userProfile.birthday;

        // Load profile picture preview
        const previewDiv = document.getElementById('profilePicturePreview');
        // SECURITY: Sanitize profile picture URL
        const safeProfilePicture = sanitizeImageURL(userProfile.profilePicture);
        if (safeProfilePicture) {
          previewDiv.innerHTML = `<img src="${safeProfilePicture}" alt="Profile Picture" class="w-full h-full object-cover rounded-full" />`;
        } else {
          const firstInitial = userProfile.firstName ? userProfile.firstName.charAt(0).toUpperCase() : 'Y';
          const lastInitial = userProfile.lastName ? userProfile.lastName.charAt(0).toUpperCase() : 'V';
          previewDiv.innerHTML = `<span id="profileInitials" class="text-white font-bold text-2xl">${escapeHTML(firstInitial)}${escapeHTML(lastInitial)}</span>`;
        }

        // Always start in view mode
        isEditMode = false;
        setProfileFieldsState(false);
        clearAllErrors();

        document.getElementById('profileModal').classList.remove('hidden');
      }

      function closeProfileModal() {
        // Reset to view mode when closing
        isEditMode = false;
        setProfileFieldsState(false);
        clearAllErrors();
        document.getElementById('profileModal').classList.add('hidden');
      }

      async function handleProfilePictureChange(event) {
        const file = event.target.files[0];
        if (!file) return;

        console.log('[PROFILE PICTURE] File selected:', file.name, file.type, file.size);

        // Validate file type
        if (!file.type.startsWith('image/')) {
          showToast('Please upload an image file', 'error');
          return;
        }

        // Validate file size (max 5MB)
        if (file.size > 5 * 1024 * 1024) {
          showToast('Image size should be less than 5MB', 'error');
          return;
        }

        try {
          // Get current user session
          const { data: { session }, error: sessionError } = await supabaseClient.auth.getSession();

          if (sessionError) throw sessionError;
          if (!session) {
            showToast('Please log in again', 'error');
            return;
          }

          console.log('[PROFILE PICTURE] User ID:', session.user.id);

          // Show loading state
          showToast('Uploading profile picture...', 'info');

          // Create unique filename: userid_timestamp.extension
          const fileExt = file.name.split('.').pop();
          const fileName = `${session.user.id}_${Date.now()}.${fileExt}`;
          const filePath = `${session.user.id}/${fileName}`;

          console.log('[PROFILE PICTURE] Upload path:', filePath);

          // Upload to Supabase Storage (user-images bucket)
          const { data: uploadData, error: uploadError } = await supabaseClient
            .storage
            .from('user-images')
            .upload(filePath, file, {
              cacheControl: '3600',
              upsert: true
            });

          if (uploadError) {
            console.error('[PROFILE PICTURE] Upload error:', uploadError);
            throw uploadError;
          }

          console.log('[PROFILE PICTURE] Upload successful:', uploadData);

          // Get public URL
          const { data: { publicUrl } } = supabaseClient
            .storage
            .from('user-images')
            .getPublicUrl(filePath);

          console.log('[PROFILE PICTURE] Public URL:', publicUrl);

          // Update database with new image URL
          const { data: dbUpdateData, error: updateError } = await supabaseClient
            .from('User_Tbl')
            .update({
              imagePathURL: publicUrl,
              updatedAt: new Date().toISOString()
            })
            .eq('userID', session.user.id)
            .select();

          if (updateError) {
            console.error('[PROFILE PICTURE] DB update error:', updateError);
            throw updateError;
          }

          if (!dbUpdateData || dbUpdateData.length === 0) {
            console.error('[PROFILE PICTURE] No rows updated in database');
            showToast('Failed to save profile picture URL to database', 'error');
            return;
          }

          console.log('[PROFILE PICTURE] Database updated:', dbUpdateData[0]);

          // Update local profile
          userProfile.profilePicture = publicUrl;
          console.log('[PROFILE PICTURE] Updated userProfile.profilePicture:', userProfile.profilePicture);

          // Update modal preview
          const previewDiv = document.getElementById('profilePicturePreview');
          if (previewDiv) {
            previewDiv.innerHTML = `<img src="${publicUrl}" alt="Profile Picture" class="w-full h-full object-cover rounded-full" onload="console.log('[PROFILE PICTURE] Modal image loaded successfully')" onerror="console.error('[PROFILE PICTURE] Modal image FAILED to load:', this.src)" />`;
            console.log('[PROFILE PICTURE] Modal preview updated');
          } else {
            console.error('[PROFILE PICTURE] profilePicturePreview element not found!');
          }

          // Update header avatar
          console.log('[PROFILE PICTURE] Calling updateProfilePicture()...');
          updateProfilePicture();
          console.log('[PROFILE PICTURE] updateProfilePicture() completed');

          showToast('Profile picture uploaded successfully!', 'success');

        } catch (error) {
          console.error('[PROFILE PICTURE] Error:', error);
          showToast(`Failed to upload: ${error.message || 'Unknown error'}`, 'error');
        }
      }

      async function saveProfile() {
        try {
          // Clear all previous errors
          clearAllErrors();

          // Get form values
          const firstName = document.getElementById('profileFirstName').value.trim();
          const middleName = document.getElementById('profileMiddleName').value.trim();
          const lastName = document.getElementById('profileLastName').value.trim();
          const address = document.getElementById('profileAddress').value.trim();
          const contact = document.getElementById('profileContact').value.trim();
          const birthday = document.getElementById('profileBirthday').value;
          const gender = document.getElementById('profileGender').value;

          // Comprehensive validation with visual feedback
          let isValid = true;

          // Validate first name
          isValid = validateField('profileFirstName', firstName, {
            required: true,
            minLength: 2,
            maxLength: 50,
            errorId: 'firstNameError',
            fieldName: 'First name'
          }) && isValid;

          // Validate middle name (optional but has length constraints if provided)
          if (middleName) {
            isValid = validateField('profileMiddleName', middleName, {
              required: false,
              maxLength: 50,
              errorId: 'middleNameError',
              fieldName: 'Middle name'
            }) && isValid;
          }

          // Validate last name
          isValid = validateField('profileLastName', lastName, {
            required: true,
            minLength: 2,
            maxLength: 50,
            errorId: 'lastNameError',
            fieldName: 'Last name'
          }) && isValid;

          // Validate contact number
          isValid = validateField('profileContact', contact, {
            required: true,
            pattern: /^09\d{9}$/,
            patternMessage: 'Contact number must be 11 digits starting with 09',
            errorId: 'contactError',
            fieldName: 'Contact number'
          }) && isValid;

          // Validate address
          isValid = validateField('profileAddress', address, {
            required: true,
            minLength: 10,
            maxLength: 200,
            errorId: 'addressError',
            fieldName: 'Address'
          }) && isValid;

          // Validate birthday with age check
          isValid = validateField('profileBirthday', birthday, {
            required: true,
            errorId: 'birthdayError',
            fieldName: 'Birthday',
            customValidation: (value) => {
              if (!value) return { valid: false, message: 'Birthday is required' };

              const birthDate = new Date(value);
              const today = new Date();
              let age = today.getFullYear() - birthDate.getFullYear();
              const monthDiff = today.getMonth() - birthDate.getMonth();

              if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
              }

              if (age < 15) {
                return { valid: false, message: 'You must be at least 15 years old' };
              }

              if (age > 100) {
                return { valid: false, message: 'Please enter a valid birth date' };
              }

              return { valid: true };
            }
          }) && isValid;

          // If validation failed, show error toast and return
          if (!isValid) {
            showToast('Please fix the errors before saving', 'error');
            return;
          }

          // Get current user session
          const { data: { session }, error: sessionError } = await supabaseClient.auth.getSession();

          if (sessionError) throw sessionError;
          if (!session) {
            showToast('Please log in again', 'error');
            window.location.href = 'login.html';
            return;
          }

          // Format names to Title Case
          const formatName = (name) => {
            if (!name) return '';
            return name
              .split(' ')
              .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
              .join(' ');
          };

          // Update database
          console.log('[SAVE PROFILE] Updating database for userID:', session.user.id);
          const { data: updateData, error: updateError, count } = await supabaseClient
            .from('User_Tbl')
            .update({
              firstName: formatName(firstName),
              middleName: middleName ? formatName(middleName) : null,
              lastName: formatName(lastName),
              address: address,
              contactNumber: contact,
              birthday: birthday,
              gender: gender || null,
              updatedAt: new Date().toISOString()
            })
            .eq('userID', session.user.id)
            .select();

          console.log('[SAVE PROFILE] Update result:', { data: updateData, error: updateError, count });

          if (updateError) {
            console.error('[SAVE PROFILE] Database update error:', updateError);
            console.error('[SAVE PROFILE] Error details:', {
              message: updateError.message,
              code: updateError.code,
              details: updateError.details,
              hint: updateError.hint
            });
            showToast(`Database error: ${updateError.message}`, 'error');
            throw updateError;
          }

          if (!updateData || updateData.length === 0) {
            console.error('[SAVE PROFILE] No rows updated. Check RLS policies.');
            showToast('Failed to update profile. Please check permissions.', 'error');
            return;
          }

          console.log('[SAVE PROFILE] Profile updated successfully:', updateData[0]);

          // Update local userProfile object
          userProfile.firstName = formatName(firstName);
          userProfile.middleName = middleName ? formatName(middleName) : '';
          userProfile.lastName = formatName(lastName);
          userProfile.address = address;
          userProfile.contact = contact;
          userProfile.birthday = birthday;
          userProfile.gender = gender;

          // Update UI
          updateProfileUI();

          showToast('Profile updated successfully!', 'success');
          closeProfileModal();

        } catch (error) {
          console.error('Error saving profile:', error);
          showToast('Failed to save profile. Please try again.', 'error');
        }
      }

      // Old showToast function removed - using modern version below

      // Announcements will be loaded from Supabase
      let announcements = {};
      let announcementsArray = [];

      // Helper function to format relative date
      function formatRelativeDate(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diffMs = now - date;
        const diffSec = Math.floor(diffMs / 1000);
        const diffMin = Math.floor(diffSec / 60);
        const diffHour = Math.floor(diffMin / 60);
        const diffDay = Math.floor(diffHour / 24);

        // Less than 1 minute
        if (diffSec < 60) {
          return 'Just now';
        }
        // Less than 1 hour
        else if (diffMin < 60) {
          return `${diffMin} ${diffMin === 1 ? 'minute' : 'minutes'} ago`;
        }
        // Less than 24 hours
        else if (diffHour < 24) {
          return `${diffHour} ${diffHour === 1 ? 'hour' : 'hours'} ago`;
        }
        // Less than 7 days
        else if (diffDay < 7) {
          return `${diffDay} ${diffDay === 1 ? 'day' : 'days'} ago`;
        }
        // 7 days or more - show actual date
        else {
          return date.toLocaleDateString('en-US', {
            month: 'short',
            day: 'numeric',
            year: 'numeric'
          });
        }
      }

      // EFFICIENCY: Maximum announcements to load (prevents loading too many records)
      const MAX_ANNOUNCEMENTS = 100;

      // Load announcements from Supabase
      async function loadAnnouncements() {
        try {
          // EFFICIENCY: Use .limit() to prevent loading too many records
          const { data, error } = await supabaseClient
            .from('Announcement_Tbl')
            .select('*')
            .order('publishedDate', { ascending: false })
            .limit(MAX_ANNOUNCEMENTS);

          if (error) throw error;

          if (data && data.length > 0) {
            // Convert to the format expected by the UI
            announcementsArray = data.map(announcement => ({
              id: announcement.announcementID,
              title: announcement.title,
              date: formatRelativeDate(announcement.publishedDate),
              category: announcement.category.toLowerCase(),
              description: announcement.description || 'No description available',
              image: announcement.imagePathURL || ''
            }));

            // Also create the object format for viewAnnouncement function
            announcements = {};
            announcementsArray.forEach(ann => {
              announcements[ann.id] = ann;
            });

            // Render announcements after loading
            renderAnnouncements();
          } else {
            console.log('No announcements found');
            announcementsArray = [];
          }

        } catch (error) {
          console.error('Error loading announcements:', error);
          showToast('Failed to load announcements', 'error');
          announcementsArray = [];
        }
      }

      // Announcement pagination variables
      let currentAnnouncementPage = 0;
      const announcementsPerPage = 3;

      // Render announcements with pagination
      function renderAnnouncements() {
        const grid = document.getElementById('announcementsGrid');
        if (!grid) return;

        const startIndex = currentAnnouncementPage * announcementsPerPage;
        const endIndex = startIndex + announcementsPerPage;
        const announcementsToShow = announcementsArray.slice(startIndex, endIndex);

        grid.innerHTML = '';

        announcementsToShow.forEach(announcement => {
          const categoryColors = {
            urgent: 'bg-red-100 text-red-700',
            general: 'bg-blue-100 text-blue-700',
            update: 'bg-[#2f6e4e]/20 text-[#2f6e4e]'
          };

          const gradientColors = {
            urgent: 'from-orange-400 to-orange-500',
            general: 'from-blue-400 to-blue-500',
            update: 'from-green-400 to-green-500'
          };

          const iconPaths = {
            urgent: 'M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z',
            general: 'M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253',
            update: 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z'
          };

          const card = document.createElement('article');
          card.className = 'border border-gray-200 rounded-xl overflow-hidden hover:shadow-lg transition flex flex-col';

          // SECURITY: Sanitize image URL and use escapeHTML to prevent XSS attacks
          const safeImageUrl = sanitizeImageURL(announcement.image);

          // Show image if available, otherwise show gradient with icon
          const imageSection = safeImageUrl
            ? `<img src="${safeImageUrl}" alt="${escapeHTML(announcement.title)}" class="w-full h-36 object-cover" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
               <div class="h-36 bg-gradient-to-br ${gradientColors[announcement.category] || gradientColors.general} items-center justify-center hidden">
                 <svg class="w-20 h-20 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                   <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${iconPaths[announcement.category] || iconPaths.general}"></path>
                 </svg>
               </div>`
            : `<div class="h-36 bg-gradient-to-br ${gradientColors[announcement.category] || gradientColors.general} flex items-center justify-center">
                 <svg class="w-20 h-20 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                   <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${iconPaths[announcement.category] || iconPaths.general}"></path>
                 </svg>
               </div>`;

          card.innerHTML = `
            <div class="relative">
              ${imageSection}
            </div>
            <div class="p-5 flex flex-col flex-1">
              <div class="flex items-center justify-between mb-3">
                <span class="px-3 py-1 ${categoryColors[announcement.category] || categoryColors.general} text-xs font-medium rounded-full">${escapeHTML(announcement.category)}</span>
                <span class="text-xs text-gray-500">${escapeHTML(announcement.date)}</span>
              </div>
              <h4 class="text-lg font-bold text-gray-800 mb-2">${escapeHTML(announcement.title)}</h4>
              <p class="announcement-description text-sm text-gray-600 mb-4">${escapeHTML(announcement.description)}</p>
              <div class="flex justify-end mt-auto">
                <button onclick="viewAnnouncement(${Number(announcement.id)})" class="px-4 py-2 bg-[#2f6e4e] hover:bg-[#2f6e4e] text-white rounded-lg text-sm font-medium transition">
                  View
                </button>
              </div>
            </div>
          `;

          grid.appendChild(card);
        });

        updateAnnouncementPagination();
      }

      // Update announcement pagination controls
      function updateAnnouncementPagination() {
        const totalPages = Math.ceil(announcementsArray.length / announcementsPerPage);
        const dotsContainer = document.getElementById('announcementPaginationDots');
        const navContainer = document.getElementById('announcementPaginationNav');

        if (totalPages <= 1) {
          dotsContainer.classList.add('hidden');
          navContainer.classList.add('hidden');
          return;
        }

        dotsContainer.classList.remove('hidden');
        navContainer.classList.remove('hidden');

        // Create pagination dots
        dotsContainer.innerHTML = Array.from({ length: totalPages }, (_, i) => `
          <button
            onclick="goToAnnouncementPage(${i})"
            class="h-2 rounded-full transition-all duration-300 ${i === currentAnnouncementPage ? 'bg-[#2f6e4e] w-8' : 'bg-gray-300 hover:bg-gray-400 w-2'}"
            style="min-height: 8px;"
          ></button>
        `).join('');
      }

      // Navigate announcements
      function navigateAnnouncements(direction) {
        const totalPages = Math.ceil(announcementsArray.length / announcementsPerPage);
        currentAnnouncementPage += direction;

        // Wrap around
        if (currentAnnouncementPage < 0) currentAnnouncementPage = totalPages - 1;
        if (currentAnnouncementPage >= totalPages) currentAnnouncementPage = 0;

        renderAnnouncements();
      }

      // Go to specific announcement page
      function goToAnnouncementPage(pageIndex) {
        currentAnnouncementPage = pageIndex;
        renderAnnouncements();
      }

      // Initialize announcements
      renderAnnouncements();

      // sample applications
      const applications = {
        101: {
          project: "Community Garden Project",
          applied: "Nov 10, 2025",
          role: "Event Volunteer",
          status: "Pending Review",
          notes: "Awaiting confirmation",
        },
        102: {
          project: "Youth Sports Festival 2025",
          applied: "Nov 5, 2025",
          role: "Court Marshal",
          status: "Approved",
          notes: "Report to court B at 7AM",
        },
        103: {
          project: "Free Skills Training Workshop",
          applied: "Oct 30, 2025",
          role: "Assistant Instructor",
          status: "Rejected",
          notes: "Slots full",
        },
        104: {
          project: "Beach Cleanup Drive",
          applied: "Sep 20, 2025",
          role: "Volunteer",
          status: "Completed",
          notes: "Certificate available",
        },
      };

      // Old demo notification system removed - now using NotificationModal.js component with Supabase

      // Notification modal functions removed - now handled by NotificationModal.js component

      // Announcement modal handlers
      function viewAnnouncement(id) {
        const a = announcements[id];
        document.getElementById("announceTitle").textContent = a.title;
        document.getElementById("announceDate").textContent = a.date;
        document.getElementById("announceDesc").textContent =
          a.description || "";

        // Update category badge with proper styling
        const categoryBadge = document.getElementById("announceCategory");
        categoryBadge.textContent = a.category;

        // Remove all category classes
        categoryBadge.className =
          "inline-block px-3 py-1 text-xs font-medium rounded-full";

        // Add category-specific classes
        if (a.category === "urgent") {
          categoryBadge.classList.add("bg-red-100", "text-red-700");
        } else if (a.category === "general") {
          categoryBadge.classList.add("bg-blue-100", "text-blue-700");
        } else if (a.category === "update") {
          categoryBadge.classList.add("bg-[#2f6e4e]/20", "text-[#2f6e4e]");
        }

        const imgTag = document.getElementById("announceImgTag");
        if (a.image) {
          imgTag.src = a.image;
          imgTag.style.display = "block";
        } else {
          imgTag.style.display = "none";
        }
        document.getElementById("announcementModal").classList.remove("hidden");
      }
      function closeAnnouncementModal() {
        document.getElementById("announcementModal").classList.add("hidden");
      }
      function openAllAnnouncements() {
        showToast(
          "Announcements page not yet implemented", 'info'
        );
      }

      // Application drawer handlers
      function openApplicationDetails(id) {
        const app = applications[id];
        if (!app) return;
        document.getElementById(
          "appDrawerTitle"
        ).textContent = `Application #${id}`;
        document.getElementById("appProjectTitle").textContent = app.project;
        document.getElementById(
          "appAppliedDate"
        ).textContent = `Applied: ${app.applied}`;
        document.getElementById("appRole").textContent = app.role;
        document.getElementById("appNotes").textContent = app.notes;

        const badge = document.createElement("span");
        badge.className = "px-3 py-1 rounded-full text-sm font-semibold";
        switch (app.status) {
          case "Pending Review":
            badge.classList.add("bg-yellow-100", "text-yellow-800");
            break;
          case "Approved":
            badge.classList.add("bg-[#2f6e4e]/20", "text-[#2f6e4e]");
            break;
          case "Rejected":
            badge.classList.add("bg-red-100", "text-red-700");
            break;
          case "Completed":
            badge.classList.add("bg-indigo-100", "text-indigo-700");
            break;
          default:
            badge.classList.add("bg-gray-100", "text-gray-700");
        }
        badge.textContent = app.status;
        const statusContainer = document.getElementById("appStatus");
        statusContainer.innerHTML = "";
        statusContainer.appendChild(badge);

        // open drawer
        document
          .getElementById("appDrawer")
          .classList.remove("translate-x-full");
        document.getElementById("appDrawer").classList.add("translate-x-0");
        // ensure CSS transform classes exist
        document.getElementById("appDrawer").style.transform = "translateX(0)";
      }
      function closeAppDrawer() {
        document.getElementById("appDrawer").style.transform =
          "translateX(100%)";
      }

      // keep drawer closed on load
      document.getElementById("appDrawer").style.transform = "translateX(100%)";

      // Star Rating Functionality
      let selectedRating = 0;

      function initializeStarRating() {
        const stars = document.querySelectorAll('#starRating svg');
        const ratingText = document.getElementById('ratingText');
        const satisfactionScoreInput = document.getElementById('satisfactionScore');

        stars.forEach(star => {
          star.addEventListener('click', function() {
            const rating = parseInt(this.getAttribute('data-star'));
            selectedRating = rating;
            satisfactionScoreInput.value = rating;
            updateStarDisplay(rating);
            updateRatingText(rating);
          });

          star.addEventListener('mouseenter', function() {
            const rating = parseInt(this.getAttribute('data-star'));
            updateStarDisplay(rating);
          });
        });

        document.getElementById('starRating').addEventListener('mouseleave', function() {
          updateStarDisplay(selectedRating);
        });
      }

      function updateStarDisplay(rating) {
        const stars = document.querySelectorAll('#starRating svg');
        stars.forEach((star, index) => {
          if (index < rating) {
            star.classList.remove('text-gray-300');
            star.classList.add('text-yellow-400');
          } else {
            star.classList.remove('text-yellow-400');
            star.classList.add('text-gray-300');
          }
        });
      }

      function updateRatingText(rating) {
        const ratingText = document.getElementById('ratingText');
        const ratingLabels = {
          1: '1 star - Poor',
          2: '2 stars - Fair',
          3: '3 stars - Good',
          4: '4 stars - Very Good',
          5: '5 stars - Excellent'
        };
        ratingText.textContent = ratingLabels[rating] || 'No rating selected';
      }

      // Initialize star rating on page load
      document.addEventListener('DOMContentLoaded', function() {
        initializeStarRating();
      });

      // Toast Notification System
      function showToast(message, type = 'success') {
        const existingToast = document.querySelector('.toast');
        if (existingToast) {
          existingToast.remove();
        }

        const toast = document.createElement('div');
        toast.className = `toast ${type}`;

        let icon = '';
        if (type === 'success') {
          icon = '<svg class="w-6 h-6 text-green-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
        } else if (type === 'error') {
          icon = '<svg class="w-6 h-6 text-red-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
        } else if (type === 'warning') {
          icon = '<svg class="w-6 h-6 text-yellow-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>';
        } else {
          icon = '<svg class="w-6 h-6 text-blue-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
        }

        toast.innerHTML = `
          ${icon}
          <div class="flex-1">
            <p class="text-sm font-medium text-gray-800">${message}</p>
          </div>
          <button onclick="this.parentElement.remove()" class="text-gray-400 hover:text-gray-600 transition">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        `;

        document.body.appendChild(toast);
        setTimeout(() => toast.classList.add('show'), 10);
        setTimeout(() => {
          toast.classList.remove('show');
          setTimeout(() => toast.remove(), 300);
        }, 4000);
      }

      // Character counter for textareas
      function updateCharCount(inputId, counterId, maxLength) {
        const input = document.getElementById(inputId);
        const counter = document.getElementById(counterId);
        const currentLength = input.value.length;

        counter.textContent = `${currentLength}/${maxLength} characters`;

        counter.classList.remove('warning', 'error');
        if (currentLength >= maxLength) {
          counter.classList.add('error');
        } else if (currentLength >= maxLength * 0.9) {
          counter.classList.add('warning');
        }
      }

      // Input validation helper
      function setInputState(inputElement, isValid) {
        inputElement.classList.remove('input-error', 'input-success');
        if (isValid === true) {
          inputElement.classList.add('input-success');
        } else if (isValid === false) {
          inputElement.classList.add('input-error');
        }
      }

      // Testimony Form Handling
      document.getElementById("testimonyForm").addEventListener("submit", function(e) {
        e.preventDefault();

        const testimonyInput = document.getElementById("testimonyText");
        const testimony = testimonyInput.value.trim();
        const rating = parseInt(document.getElementById("satisfactionScore").value);
        const submitButton = document.querySelector('#testimonyForm button[type="submit"]');

        let isValid = true;

        // Validate rating
        if (rating === 0) {
          showToast("Please rate your experience by clicking the stars", "warning");
          return;
        }

        // Validate testimony
        if (!testimony) {
          setInputState(testimonyInput, false);
          showToast("Please write your testimony", "error");
          return;
        }

        if (testimony.length < 50) {
          setInputState(testimonyInput, false);
          showToast("Please write at least 50 characters for your testimony", "error");
          return;
        }

        setInputState(testimonyInput, true);

        // Show confirmation modal before submitting
        showTestimonyConfirmation(testimony, rating, submitButton, testimonyInput);
      });

      // Show testimony confirmation modal
      function showTestimonyConfirmation(testimony, rating, submitButton, testimonyInput) {
        const modal = document.getElementById('testimonyConfirmModal');
        const confirmBtn = document.getElementById('testimonyConfirmOk');
        const cancelBtn = document.getElementById('testimonyConfirmCancel');

        modal.classList.remove('hidden');

        const handleConfirm = async () => {
          modal.classList.add('hidden');

          // Show loading state
          const originalButtonText = submitButton.innerHTML;
          submitButton.disabled = true;
          submitButton.innerHTML = '<div class="spinner mx-auto"></div>';

          try {
            // Get current user session
            const { data: { session }, error: sessionError } = await supabaseClient.auth.getSession();

            if (sessionError) throw sessionError;
            if (!session) {
              showToast('Please log in to submit a testimony', 'error');
              submitButton.disabled = false;
              submitButton.innerHTML = originalButtonText;
              return;
            }

            // Save testimony to database with rating
            const { error: insertError } = await supabaseClient
              .from('Testimonies_Tbl')
              .insert({
                userID: session.user.id,
                message: testimony,
                rating: rating, // Star rating (1-5)
                isFiltered: false, // Will be reviewed by SK Officials
                timeStamp: new Date().toISOString()
              });

            if (insertError) throw insertError;

            console.log("Testimony submitted successfully:", { testimony, rating });

            // Show success message
            showToast("Thank you for sharing your experience! Your testimony has been submitted for review.", "success");

            // Reset form
            resetTestimonyForm();

            // Clear validation state
            setInputState(testimonyInput, null);
            document.getElementById('testimonyCharCount').textContent = '0/500 characters';

          } catch (error) {
            console.error('Error submitting testimony:', error);
            showToast('Failed to submit testimony. Please try again.', 'error');
          } finally {
            // Re-enable button
            submitButton.disabled = false;
            submitButton.innerHTML = originalButtonText;
          }

          cleanup();
        };

        const handleCancel = () => {
          modal.classList.add('hidden');
          cleanup();
        };

        const cleanup = () => {
          confirmBtn.removeEventListener('click', handleConfirm);
          cancelBtn.removeEventListener('click', handleCancel);
        };

        confirmBtn.addEventListener('click', handleConfirm);
        cancelBtn.addEventListener('click', handleCancel);

        // Close on backdrop click
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            handleCancel();
          }
        });
      }

      function resetTestimonyForm() {
        document.getElementById("testimonyForm").reset();
        selectedRating = 0;
        document.getElementById("satisfactionScore").value = 0;
        updateStarDisplay(0);
        document.getElementById('ratingText').textContent = 'No rating selected';
      }

      // Update current date
      function updateCurrentDate() {
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        const currentDate = new Date().toLocaleDateString('en-US', options);
        const dateElement = document.getElementById('currentDate');
        if (dateElement) {
          dateElement.textContent = currentDate;
        }
      }
      updateCurrentDate();

      // Logout function
      async function handleLogout() {
        try {
          await SessionManager.logout();
        } catch (error) {
          console.error('Logout error:', error);
          // Force logout even if there's an error
          window.location.href = 'login.html';
        }
      }

      // Expose functions to global scope for onclick handlers
      window.handleLogout = handleLogout;
      // Profile functions - handled by ProfileModal component (window.profileModal)
      window.viewAnnouncement = viewAnnouncement;
      window.closeAnnouncementModal = closeAnnouncementModal;
      window.closeAppDrawer = closeAppDrawer;
      window.resetTestimonyForm = resetTestimonyForm;
      window.navigateAnnouncements = navigateAnnouncements;
      window.goToAnnouncementPage = goToAnnouncementPage;
    </script>



    <!-- Testimony Submission Confirmation Modal -->
    <div id="testimonyConfirmModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-[10000] flex items-center justify-center p-4">
      <div class="bg-white rounded-xl shadow-2xl max-w-md w-full p-6 transform transition-all">
        <div class="flex items-center justify-center w-12 h-12 mx-auto bg-[#2f6e4e]/10 rounded-full mb-4">
          <svg class="w-6 h-6 text-[#2f6e4e]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
          </svg>
        </div>
        <h3 class="text-lg font-bold text-gray-900 text-center mb-2">Submit Your Testimony</h3>
        <p class="text-sm text-gray-600 text-center mb-6">Your testimony will be reviewed by SK officials before being published. Are you sure you want to submit?</p>
        <div class="flex gap-3">
          <button id="testimonyConfirmCancel" class="flex-1 px-4 py-2.5 border border-gray-300 rounded-lg hover:bg-gray-50 transition font-medium text-gray-700">Cancel</button>
          <button id="testimonyConfirmOk" class="flex-1 px-4 py-2.5 bg-[#2f6e4e] hover:bg-[#3d8b64] text-white rounded-lg transition font-medium flex items-center justify-center space-x-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            <span>Submit</span>
          </button>
        </div>
      </div>
    </div>

      <script src="js/mobile-nav.js"></script>
  </body>
</html>
